
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Оценка скина</title>
  <script src="https://unpkg.com/skinview3d/bundles/skinview3d.bundle.js"></script>
  <style>
    body {
      background-color: #0e0e12;
      color: #fff;
      font-family: 'Inter', sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }
    .container {
      background: #15151c;
      border-radius: 16px;
      padding: 20px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 0 30px rgba(0,0,0,0.4);
    }
    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      text-align: center;
    }
    header img {
      height: 70px;
      width: auto;
    }
    header h1 {
      font-size: 1.7em;
      margin: 0;
    }
    .upload-section {
      text-align: center;
      margin-bottom: 20px;
    }
    .file-input-wrapper {
      position: relative;
      display: inline-block;
      margin-bottom: 10px;
      max-width: 100%;
      overflow: hidden;
    }
    input[type=file] {
      background: #1e1e27;
      border-radius: 8px;
      padding: 10px;
      border: 1px solid #2f2f3b;
      color: #fff;
      cursor: pointer;
      font-size: 0.9em;
      max-width: 100%;
    }
    input[type=file]::-webkit-file-upload-button {
      background: #8a2be2;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 8px;
    }
    input[type=file]::-webkit-file-upload-button:hover {
      background: #9b4dff;
    }
    .skin-preview {
      width: 100%;
      max-width: 300px;
      height: 400px;
      margin: 15px auto;
      display: block;
      border: 2px solid #2f2f3b;
      border-radius: 8px;
      background: repeating-conic-gradient(#2a2a35 0% 25%, #1e1e27 0% 50%) 50% / 20px 20px;
    }
    .criterion {
      margin-bottom: 15px;
    }
    .criterion label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-weight: 600;
    }
    input[type=range] {
      width: 100%;
      -webkit-appearance: none;
      background: linear-gradient(90deg, #007bff, #8a2be2);
      height: 6px;
      border-radius: 6px;
      outline: none;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #8a2be2;
    }
    .score-display {
      background: #1e1e27;
      border-radius: 10px;
      padding: 12px;
      text-align: center;
      font-size: 1.1em;
      font-weight: bold;
      margin-top: 20px;
    }
    textarea {
      width: 100%;
      min-height: 80px;
      background: #1b1b23;
      color: #fff;
      border: 1px solid #2f2f3b;
      border-radius: 8px;
      padding: 10px;
      resize: vertical;
      margin-bottom: 12px;
      font-family: inherit;
      box-sizing: border-box;
    }
    .reset-button, .submit-button {
      background: #8a2be2;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      margin-right: 8px;
      transition: all 0.2s;
    }
    .reset-button:hover, .submit-button:hover {
      background: #9b4dff;
      transform: translateY(-1px);
    }
    .reviews {
      margin-top: 30px;
    }
    .review-item {
      background: #1b1b23;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      border-left: 3px solid #8a2be2;

николати, [12.10.2025 3:31]
}
    .review-item h3 {
      margin-top: 0;
      color: #8a2be2;
    }
    .review-item p {
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .review-item small {
      display: block;
      margin-top: 8px;
      color: #aaa;
    }
    .review-item img {
      display: block;
      margin-top: 5px;
      border: 1px solid #2f2f3b;
      border-radius: 4px;
      max-width: 80px;
    }
    .info-text {
      text-align: center;
      color: #888;
      font-size: 0.85em;
      margin-top: 8px;
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <img src="assets/МММ_ЛОГО_ОРИГИНАЛ.png" alt="Логотип группы">
    <h1>Оценка скина</h1>
  </header>

  <div class="upload-section">
    <div class="file-input-wrapper">
      <input type="file" id="skin-upload" accept="image/png" />
    </div>
    <div class="info-text">Загрузите PNG файл скина (64x64 или 64x32)</div>
    <canvas id="skin-viewer" class="skin-preview"></canvas>
  </div>

  <div class="criterion">
    <label for="line">Лайн / Образ <span id="line-value">5</span></label>
    <input type="range" id="line" min="1" max="10" value="5">
  </div>
  <div class="criterion">
    <label for="palette">Палитра <span id="palette-value">5</span></label>
    <input type="range" id="palette" min="1" max="10" value="5">
  </div>
  <div class="criterion">
    <label for="shade">Реализация / Шейд <span id="shade-value">5</span></label>
    <input type="range" id="shade" min="1" max="10" value="5">
  </div>
  <div class="criterion">
    <label for="style">Айдентика / Стилистика <span id="style-value">5</span></label>
    <input type="range" id="style" min="1" max="10" value="5">
  </div>
  <div class="criterion">
    <label for="vibe">Общее впечатление / Вайб <span id="vibe-value">5</span></label>
    <input type="range" id="vibe" min="1" max="10" value="5">
  </div>

  <div class="score-display" id="total">Итог: 25 / 90</div>

  <textarea id="title" placeholder="Заголовок рецензии"></textarea>
  <textarea id="text" placeholder="Текст рецензии (до 8500 символов)"></textarea>

  <button class="reset-button" id="reset">Очистить</button>
  <button class="submit-button" id="submit">Сохранить</button>

  <div class="reviews" id="reviews"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const ranges = ['line','palette','shade','style','vibe'];
  const values = {line:5,palette:5,shade:5,style:5,vibe:5};
  const vibeMultiplier = {1:1,2:1.0675,3:1.1349,4:1.2024,5:1.2699,6:1.3373,7:1.4048,8:1.4723,9:1.5397,10:1.6072};
  let viewer;

  function calculateTotal() {
    const baseSum = values.line + values.palette + values.shade + values.style;
    const scaled = baseSum * 1.4;
    const multiplier = vibeMultiplier[values.vibe];
    const total = Math.round(scaled * multiplier);
    document.getElementById('total').textContent = Итог: ${total} / 90;
  }

  ranges.forEach(id => {
    const input = document.getElementById(id);
    const label = document.getElementById(${id}-value);
    input.addEventListener('input', () => {
      values[id] = parseInt(input.value);
      label.textContent = input.value;
      calculateTotal();
    });
  });

  document.getElementById('skin-upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if(file) {
      const reader = new FileReader();
      reader.onload = evt => {
        const skinDataUrl = evt.target.result;
        if(!viewer) {
          viewer = new skinview3d.SkinViewer({
            canvas: document.getElementById('skin-viewer'),
            width: 300,
            height: 400,
            skin: skinDataUrl
          });
          viewer.zoom = 0.9;
          viewer.autoRotate = true;
        } else {
          viewer.loadSkin(skinDataUrl);
        }
      };
      reader.readAsDataURL(file);
    }
  });

николати, [12.10.2025 3:31]
document.getElementById('reset').addEventListener('click', () => {
    ranges.forEach(id=>{
      values[id]=5;
      document.getElementById(id).value=5;
      document.getElementById(${id}-value).textContent=5;
    });
    document.getElementById('title').value='';
    document.getElementById('text').value='';
    document.getElementById('skin-upload').value='';
    calculateTotal();
  });

  calculateTotal();
});
</script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBTClf2FpsEGwBBP6hFNFV2Zn8DordYLkA",
    authDomain: "skinsrzt.firebaseapp.com",
    databaseURL: "https://skinsrzt-default-rtdb.firebaseio.com",
    projectId: "skinsrzt",
    storageBucket: "skinsrzt.appspot.com",  // ✅ исправил
    messagingSenderId: "1084042281569",
    appId: "1:1084042281569:web:25872944cf7dac7fd66020",
    measurementId: "G-YSFQLYDWJC"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Загружаем отзывы
  async function loadReviews() {
    const q = query(collection(db,"reviews"), orderBy("createdAt","desc"));
    const snapshot = await getDocs(q);
    snapshot.forEach(doc=>{
      const r = doc.data();
      const reviewDiv = document.createElement('div');
      reviewDiv.classList.add('review-item');
      reviewDiv.innerHTML = 
        <h3>${r.title}</h3>
        <p>${r.text}</p>
        <small>Оценка: ${r.total} / 90</small>
        ${r.createdAt ? <small>${r.createdAt.toDate().toLocaleString()}</small> : ""}
        ${r.skin ? <img src="${r.skin}" /> : ''}
      ;
      document.getElementById('reviews').appendChild(reviewDiv);
    });
  }
  loadReviews();

  // Сохраняем отзыв
  document.getElementById('submit').addEventListener('click', async () => {
    const title = document.getElementById('title').value.trim();
    const text = document.getElementById('text').value.trim();
    if (!title || !text) return alert("Введите заголовок и текст");

    const values = {
      line: parseInt(document.getElementById('line').value),
      palette: parseInt(document.getElementById('palette').value),
      shade: parseInt(document.getElementById('shade').value),
      style: parseInt(document.getElementById('style').value),
      vibe: parseInt(document.getElementById('vibe').value)
    };
    const vibeMultiplier = {1:1,2:1.0675,3:1.1349,4:1.2024,5:1.2699,6:1.3373,7:1.4048,8:1.4723,9:1.5397,10:1.6072};
    const total = Math.round((values.line + values.palette + values.shade + values.style)*1.4*vibeMultiplier[values.vibe]);

    try {
      await addDoc(collection(db,"reviews"),{
        title,
        text,
        total,
        skin: null,
        createdAt: serverTimestamp()
      });
      alert("Рецензия сохранена!");
      location.reload();
    } catch(err) {
      console.error(err);
      alert("Ошибка при сохранении!");
    }
  });
</script>
</body>
</html>
