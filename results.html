<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" href="data:,">
<title>–ò—Ç–æ–≥–∏ –∫–æ–Ω–∫—É—Ä—Å–∞ ‚Äî Results</title>
<style>
  :root{
    --bg:#0e0e12; --card:#14141a; --accent:#8a2be2; --text:#eaeaf2; --muted:#9aa0b2;
    --gold: #ffd700; --silver: #c0c0c0; --bronze: #cd7f32;
  }
  * { box-sizing: border-box; }
  body{ margin:0; font-family:Inter,Arial,Helvetica,sans-serif; background:var(--bg); color:var(--text); padding:22px; }
  .wrap{ max-width:1200px; margin:0 auto; }
  header{ display:flex; align-items:center; gap:12px; margin-bottom:24px; flex-wrap:wrap; padding-bottom:16px; border-bottom:1px solid rgba(255,255,255,0.05); }
  .btn{ background:var(--accent); color:#fff; padding:10px 16px; border-radius:8px; text-decoration:none; font-weight:700; cursor:pointer; border: none; transition: all 0.3s ease; font-size:0.95rem; }
  .btn:hover{ transform: translateY(-2px); box-shadow: 0 4px 12px rgba(138,43,226,0.4); }
  .btn:disabled{ opacity:0.5; cursor:not-allowed; transform:none; }
  
  .info-btn{ background:rgba(138,43,226,0.15); color:var(--text); padding:8px 14px; border-radius:8px; border:1px solid rgba(138,43,226,0.3); cursor:pointer; font-weight:600; transition: all 0.3s ease; font-size:0.9rem; }
  .info-btn:hover{ background:rgba(138,43,226,0.25); border-color:rgba(138,43,226,0.5); }
  .info-btn:disabled{ opacity:0.5; cursor:not-allowed; }
  .info-btn svg{ transition: transform 0.6s ease; }
  .info-btn:hover svg{ transform: rotate(180deg); }
  
  .podium-title{ text-align:center; font-size:2.4rem; font-weight:900; margin-bottom:48px; background: linear-gradient(90deg, var(--gold), var(--silver), var(--bronze)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -1.5px; text-transform: uppercase; }
  
  .podium-wrapper{ display:flex; align-items:flex-end; justify-content:center; gap:20px; margin-bottom:40px; padding:0 20px; }
  
  .podium-column{ display:flex; flex-direction:column; align-items:center; }
  
  .podium-medal-single{ text-align:center; margin-bottom:16px; }
  .podium-number{ font-size:6rem; font-weight:900; line-height:1; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; letter-spacing:-0.05em; margin-bottom:8px; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.5)); }
  .podium-number-1{ color: #FFD700; background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
  .podium-number-2{ color: #C0C0C0; background: linear-gradient(135deg, #E8E8E8 0%, #A8A8A8 50%, #E8E8E8 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
  .podium-number-3{ color: #CD7F32; background: linear-gradient(135deg, #CD7F32 0%, #8B4513 50%, #CD7F32 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
  .podium-medal-label{ font-size:0.95rem; font-weight:700; }
  
  .place{ background:linear-gradient(135deg, rgba(138,43,226,0.08), rgba(20,16,30,0.5)); border-radius:12px; padding:16px; border:2px solid rgba(138,43,226,0.15); cursor:pointer; position:relative; overflow:hidden; transition: all 0.3s ease; display:flex; flex-direction:column; align-items:center; width:100%; }
  .place:hover{ transform: translateY(-8px); box-shadow: 0 12px 32px rgba(138,43,226,0.4); border-color: rgba(138,43,226,0.5); }
  .place::before{ content:''; position:absolute; top:0; left:0; right:0; height:3px; }
  
  .podium-column-1{ order:2; }
  .podium-column-1 .place{ width:280px; min-height:360px; border-color: rgba(255,215,0,0.4); }
  .podium-column-1 .place::before{ background: linear-gradient(90deg, var(--gold), #ffed4e); }
  
  .podium-column-2{ order:1; }
  .podium-column-2 .place{ width:260px; min-height:320px; border-color: rgba(192,192,192,0.4); }
  .podium-column-2 .place::before{ background: linear-gradient(90deg, var(--silver), #e8e8e8); }
  
  .podium-column-3{ order:3; }
  .podium-column-3 .place{ width:260px; min-height:280px; border-color: rgba(205,127,50,0.4); }
  .podium-column-3 .place::before{ background: linear-gradient(90deg, var(--bronze), #e89b5f); }
  
  .place-content{ display:flex; flex-direction:column; align-items:center; text-align:center; width:100%; gap:12px; }
  .place-preview{ width:150px; height:190px; border-radius:10px; overflow:hidden; background:#0a0a0f; box-shadow: 0 4px 16px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.03); flex-shrink:0; }
  .place-preview img{ width:100%; height:100%; object-fit:contain; transition: transform 0.4s ease; }
  .place:hover .place-preview img{ transform: scale(1.05); }
  
  .place-author{ font-weight:800; font-size:1.3rem; margin-bottom:8px; letter-spacing:-0.3px; line-height:1.2; }
  .place-number{ font-size:1.1rem; font-weight:700; margin-bottom:12px; opacity:0.9; }
  .place-1 .place-number{ color: var(--gold); }
  .place-2 .place-number{ color: var(--silver); }
  .place-3 .place-number{ color: var(--bronze); }
  
  .place-score{ background:rgba(138,43,226,0.25); padding:12px 20px; border-radius:10px; font-size:1.2rem; font-weight:800; border: 1px solid rgba(138,43,226,0.3); margin-top:auto; letter-spacing:0.5px; }
  
  .grid{ display:grid; grid-template-columns:1fr; gap:14px; }
  .card{ display:flex; gap:14px; align-items:center; padding:14px; background:var(--card); border-radius:12px; border:1px solid rgba(255,255,255,0.05); cursor:pointer; transition: all 0.3s ease; position:relative; }
  .card:hover{ transform: translateX(6px); border-color: rgba(138,43,226,0.3); box-shadow: -6px 0 16px rgba(138,43,226,0.2); background: rgba(20,20,26,0.9); }
  
  .thumb{ width:140px; height:180px; min-width:140px; border-radius:10px; overflow:hidden; background:#0a0a0f; display:flex; align-items:center; justify-content:center; position:relative; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.03); }
  .thumb img{ width:100%; height:100%; object-fit:contain; transition: transform 0.3s ease; }
  .card:hover .thumb img{ transform: scale(1.08); }
  
  .meta{ flex:1; min-width:0; }
  .meta h2{ margin:0 0 8px 0; font-size:1.15rem; font-weight:700; letter-spacing:-0.2px; }
  .small{ color:var(--muted); font-size:0.9rem; line-height:1.5; letter-spacing:0.2px; }
  .score-badge{ background:rgba(138,43,226,0.2); padding:8px 14px; border-radius:8px; display:inline-block; font-weight:700; font-size:1rem; border: 1px solid rgba(138,43,226,0.3); margin-top:10px; letter-spacing:0.3px; }
  
  .modal{ display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.85); z-index:1000; align-items:center; justify-content:center; padding:20px; backdrop-filter:blur(4px); }
  .modal.active{ display:flex; }
  .modal-content{ background:var(--card); border-radius:16px; padding:24px; max-width:700px; width:100%; max-height:80vh; overflow-y:auto; border:1px solid rgba(138,43,226,0.2); box-shadow:0 8px 32px rgba(0,0,0,0.6); }
  .modal-content h2{ margin:0 0 16px 0; font-size:1.5rem; color:var(--accent); font-weight:800; letter-spacing:-0.5px; }
  .modal-content h3{ margin:16px 0 8px 0; font-size:1.1rem; color:var(--text); font-weight:700; letter-spacing:-0.2px; }
  .modal-content p{ line-height:1.7; color:var(--muted); margin:0 0 12px 0; }
  .close-modal{ position:absolute; top:12px; right:12px; width:32px; height:32px; background:rgba(255,255,255,0.08); border:none; border-radius:8px; cursor:pointer; font-size:1.5rem; color:var(--text); transition:all 0.2s ease; display:flex; align-items:center; justify-content:center; }
  .close-modal:hover{ background:rgba(255,255,255,0.15); transform:scale(1.1); }
  
  .admin-form{ margin:16px 0; padding:16px; background:rgba(255,255,255,0.015); border-radius:12px; border: 1px solid rgba(255,255,255,0.04); }
  .hidden{ display:none; }
  input, button, textarea, select { font-family:inherit; }
  input[type="text"]{ padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background:#0e0e12; color:var(--text); font-size:0.95rem; transition:all 0.2s ease; }
  input[type="text"]:focus{ outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(138,43,226,0.1); }
  .file-label{ display:inline-block; padding:10px 14px; background:#1a1a22; border-radius:8px; cursor:pointer; border:1px solid rgba(255,255,255,0.08); transition: all 0.2s ease; font-size:0.95rem; font-weight:600; }
  .file-label:hover{ background:#242430; border-color: rgba(138,43,226,0.4); }
  .admin-small{ color:var(--muted); font-size:0.85rem; margin-top:8px; line-height:1.4; }
  code{ background:rgba(255,255,255,0.05); padding:2px 6px; border-radius:4px; font-family:'Courier New', monospace; font-size:0.9em; }
  
  .loading-spinner{ width:40px; height:40px; border:3px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius:50%; animation: spin 0.8s linear infinite; }
  @keyframes spin{ to{ transform: rotate(360deg); } }
  
  @media (max-width:900px){
    .thumb{ width:100px; height:130px; min-width:100px; }
    .podium-wrapper{ flex-direction:column; align-items:center; gap:20px; padding:0; }
    .podium-column{ width:100% !important; max-width:340px; order:initial !important; }
    .podium-column .place{ width:100% !important; min-height:300px !important; }
    .podium-number{ font-size:4.5rem; }
    .place-author{ font-size:1.05rem; }
    .podium-title{ font-size:1.8rem; }
    .place-preview{ width:130px; height:170px; }
    .place-score{ font-size:0.95rem; padding:6px 12px; }
    header{ flex-direction:column; align-items:flex-start; }
    header > div:last-child{ width:100%; justify-content:flex-start; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 style="font-size:1.8rem; font-weight:800; margin:0; letter-spacing:-0.5px;">–ò—Ç–æ–≥–∏ –∫–æ–Ω–∫—É—Ä—Å–∞</h1>
      <div style="margin-left:auto; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <div style="display:flex; flex-direction:column; align-items:flex-end; gap:4px;">
          <button id="refreshBtn" class="info-btn" title="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" style="padding:8px 12px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;">
              <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
            </svg>
          </button>
          <span id="cacheIndicator" style="font-size:0.7rem; color:var(--muted); white-space:nowrap;"></span>
        </div>
        <button id="infoBtn" class="info-btn">‚ÑπÔ∏è –û—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ</button>
      <a href="contests.html" class="btn" style="background:#333;display:inline-flex;align-items:center;gap:6px;">
  <svg style="width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round" viewBox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
  –í—Å–µ –∫–æ–Ω–∫—É—Ä—Å—ã
</a>
        <button id="signBtn" class="btn">–í–æ–π—Ç–∏</button>
      </div>
    </header>

    <!-- admin form -->
    <div id="adminWrap" class="admin-form hidden">
      <strong style="font-size:1.05rem;">–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–Ω –≤ –∫–æ–Ω–∫—É—Ä—Å (–∞–¥–º–∏–Ω)</strong>
      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <input id="authorInput" type="text" placeholder="–ù–∏–∫ –∞–≤—Ç–æ—Ä–∞" style="width:240px;">
        <label class="file-label">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª <input id="fileInput" type="file" accept=".png,.jpg,.jpeg" style="display:none"></label>
        <button id="addBtn" class="btn">–î–æ–±–∞–≤–∏—Ç—å</button>
        <span id="adminMsg" class="small" style="margin-left:8px;"></span>
      </div>
      <div class="admin-small">–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ dataURL –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ <code>contest_entries</code>.</div>
    </div>

    <div id="podiumSection" style="display:none;">
      <div class="podium-title">–ü–†–ò–ó–Å–†–´ –ö–û–ù–ö–£–†–°–ê</div>
      <div id="podiumWrap" class="podium-wrapper"></div>
    </div>
    
    <div id="listWrap" class="grid"></div>
    <div id="emptyMsg" class="small" style="text-align:center;margin-top:32px;display:none;font-size:1.05rem;">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–Ω–∫—É—Ä—Å–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤.</div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
  <div id="infoModal" class="modal">
    <div class="modal-content" style="position:relative;">
      <button class="close-modal" id="closeModal">√ó</button>
      <h2>–°–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è</h2>
      <p>–ü—Ä–∏ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ —Å–∫–∏–Ω–æ–≤, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –ú–ú–ú –Ω–∞ –æ—Å–Ω–æ–≤–µ 90 –±–∞–ª—å–Ω–æ–π —à–∫–∞–ª—ã –†–ó–¢ (–†–∏—Å–∞ –∑–∞ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ). –°–∏—Å—Ç–µ–º–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —á–∏—Å–ª–æ–≤—ã—Ö –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –∏ 1 –º–Ω–æ–∂–∏—Ç–µ–ª—è.</p>
      
      <h3>–õ–∞–π–Ω / –û–±—Ä–∞–∑ (1-10)</h3>
      <p>–û—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –æ–±—â–∞—è –∏–¥–µ—è –ª–∞–π–Ω–∞, —Ç–æ –∫–∞–∫ –≥—Ä–∞–º–æ—Ç–Ω–æ –∏ –ª–∞–∫–æ–Ω–∏—á–Ω–æ —ç—Ç–∞ –∏–¥–µ—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –ª–∏ –æ–Ω, –Ω–∞—Å–∫–æ–ª—å–∫–æ –æ–Ω –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∏ –Ω–µ–æ–±—ã—á–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç, –∫–∞–∫–∏–µ-—Ç–æ –Ω–µ–æ–±—ã—á–Ω—ã–µ –¥–µ—Ç–∞–ª–∏, –∏–¥–µ–∏ –¥–æ–±–∞–≤–ª—è—é—Ç –±–∞–ª–ª–æ–≤. –í —Ä–∞–º–∫–∞—Ö –∫–æ–Ω–∫—É—Ä—Å–∞ —Ç–∞–∫–∂–µ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–∫–∏–Ω–∞ –∏–¥–µ–µ –•—ç–ª–ª–æ—É–∏–Ω–∞.</p>
      
      <h3>–ü–∞–ª–∏—Ç—Ä–∞ (1-10)</h3>
      <p>–û—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è —Ç–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –ø–æ–¥–æ–±—Ä–∞–Ω—ã —Ü–≤–µ—Ç–∞, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –æ–Ω–∏ —Å–æ–ø—Ä–∏–∫–∞—Å–∞—é—Ç—Å—è –∏ –¥–æ–ø–æ–ª–Ω—è—é—Ç –∏–¥–µ—é, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥–±–æ—Ä –ø–∞–ª–∏—Ç—Ä—ã –∫–∞–∫ —à–µ–π–¥–∞, —Ç–∞–∫ –∏ –ª–∞–π–Ω–∞ –∏, –∫–æ–Ω–µ—á–Ω–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ü–≤–µ—Ç–∞ –≤ —Ü–µ–ª–æ–º –ø—Ä–∏—è—Ç–Ω—ã –≥–ª–∞–∑—É, –Ω–µ —Å–ª–∏–≤–∞—é—Ç—Å—è –ª–∏ –∫–∞–∫–∏–µ-–ª–∏–±–æ —á–∞—Å—Ç–∏ –Ω–∞ —Å–∫–∏–Ω–µ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º.</p>
      
      <h3>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –®–µ–π–¥ (1-10)</h3>
      <p>–û—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è —Ç–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ª–∞–π–Ω (–∑–∞—á–∞—Å—Ç—É—é –∏–¥–µ—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö–æ—Ä–æ—à–µ–π, –∫ –ø—Ä–∏–º–µ—Ä—É, –Ω–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–æ–π –∏–¥–µ–∏ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∂–µ–ª–∞—Ç—å –ª—É—á—à–µ–≥–æ), –Ω–∞—Å–∫–æ–ª—å–∫–æ —É–º–µ—Å—Ç–µ–Ω —à–µ–π–¥–∏–Ω–≥, –∫–∞–∫ –æ–Ω –¥–æ–ø–æ–ª–Ω—è–µ—Ç –∏–¥–µ—é —Å–∫–∏–Ω–∞.</p>
      
      <h3>–ê–π–¥–µ–Ω—Ç–∏–∫–∞ / –°—Ç–∏–ª–∏—Å—Ç–∏–∫–∞ (1-10)</h3>
      <p>–û—Ü–µ–Ω–∏–≤–µ—Ç—Å—è –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å—Ç–∏–ª—å —É–Ω–∏–∫–∞–ª–µ–Ω –∏ —É–∑–Ω–∞–≤–∞–µ–º —Å—Ä–µ–¥–∏ –¥—Ä—É–≥–∏—Ö, –ø–æ–∂–∞–ª—É–π —Å–∞–º—ã–π —Å–ø–æ—Ä–Ω—ã–π, –Ω–æ –Ω–µ—Å–æ–º–Ω–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã–π –∫—Ä–∏—Ç–µ—Ä–∏–π, –≤–µ–¥—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ –±–æ–ª—å—à–æ–º –ø–æ—Ç–æ–∫–µ —Ä–∞–±–æ—Ç –∏–≥—Ä–∞–µ—Ç —Ä–µ—à–∞—é—â—É—é —Ä–æ–ª—å.</p>
      
      <h3>–û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ / –í–∞–π–± (–º–Ω–æ–∂–∏—Ç–µ–ª—å 1-10)</h3>
      <p>–°—É–±—ä–µ–∫—Ç–∏–≤–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å, —Ç–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –æ—Ü–µ–Ω–∏–≤–∞—é—â–µ–º—É –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è —Å–∫–∏–Ω, –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å –æ–±—ã—á–Ω–æ–π —à–∫–∞–ª–æ–π –æ—Ç 1 –¥–æ 10, –∫–æ—Ç–æ—Ä–∞—è –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ.</p>
      
      <p style="margin-top:20px;padding:12px;background:rgba(138,43,226,0.12);border-radius:8px;border-left:3px solid var(--accent);"><strong>–ò—Ç–æ–≥–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞:</strong><br>–ë–∞–ª–ª = (–õ–∞–π–Ω + –ü–∞–ª–∏—Ç—Ä–∞ + –†–µ–∞–ª–∏–∑–∞—Ü–∏—è + –°—Ç–∏–ª–∏—Å—Ç–∏–∫–∞) √ó 1.4 √ó –ú–Ω–æ–∂–∏—Ç–µ–ª—å_–≤–∞–π–±–∞<br><strong>–ú–∞–∫—Å–∏–º—É–º: 90 –±–∞–ª–ª–æ–≤</strong></p>
    </div>
  </div>

  <!-- SkinView3D -->
  <script src="https://unpkg.com/skinview3d/bundles/skinview3d.bundle.js"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signInWithPopup, signOut, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBTClf2FpsEGwBBP6hFNFV2Zn8DordYLkA",
      authDomain: "skinsrzt.firebaseapp.com",
      projectId: "skinsrzt",
      storageBucket: "skinsrzt.appspot.com",
      messagingSenderId: "1084042281569",
      appId: "1:1084042281569:web:25872944cf7dac7fd66020"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    // –í–∫–ª—é—á–∞–µ–º –æ—Ñ—Ñ–ª–∞–π–Ω –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Firebase (—Å–Ω–∏–∂–∞–µ—Ç reads –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–∫–∞—Ö)
    enableIndexedDbPersistence(db).catch(err => {
      if (err.code === 'failed-precondition') {
        console.log('Persistence: –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–æ–∫ –æ—Ç–∫—Ä—ã—Ç–æ');
      } else if (err.code === 'unimplemented') {
        console.log('Persistence: –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç');
      }
    });

    const adminWrap = document.getElementById('adminWrap');
    const authorInput = document.getElementById('authorInput');
    const fileInput = document.getElementById('fileInput');
    const addBtn = document.getElementById('addBtn');
    const adminMsg = document.getElementById('adminMsg');
    const listWrap = document.getElementById('listWrap');
    const podiumWrap = document.getElementById('podiumWrap');
    const podiumSection = document.getElementById('podiumSection');
    const emptyMsg = document.getElementById('emptyMsg');
    const signBtn = document.getElementById('signBtn');
    const infoBtn = document.getElementById('infoBtn');
    const infoModal = document.getElementById('infoModal');
    const closeModal = document.getElementById('closeModal');
    const refreshBtn = document.getElementById('refreshBtn');
    const cacheIndicator = document.getElementById('cacheIndicator');

    const ADMIN_EMAIL = "nmprokhorov@gmail.com";
    const MEDALS = ['ü•á', 'ü•à', 'ü•â'];
    const MEDAL_LABELS = ['1 –º–µ—Å—Ç–æ', '2 –º–µ—Å—Ç–æ', '3 –º–µ—Å—Ç–æ'];
    const MEDAL_COLORS = ['var(--gold)', 'var(--silver)', 'var(--bronze)'];
    
    const CACHE_KEY_ENTRIES = 'contest_entries_cache';
    const CACHE_KEY_SCORES = 'contest_scores_cache';
    const CACHE_KEY_TIMESTAMP = 'contest_cache_timestamp';
    const CACHE_DURATION = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç

    let currentUser = null;
    let entries = {};
    let scores = {};
    let rebuildTimeout = null;
    let unsubscribeEntries = null;
    let unsubscribeScores = null;
    
    // –§—É–Ω–∫—Ü–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    function saveToCache(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
      } catch(e) {
        console.log('Cache save error:', e);
      }
    }
    
    function loadFromCache(key) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : null;
      } catch(e) {
        console.log('Cache load error:', e);
        return null;
      }
    }
    
    function isCacheValid() {
      const timestamp = localStorage.getItem(CACHE_KEY_TIMESTAMP);
      if (!timestamp) return false;
      return (Date.now() - parseInt(timestamp)) < CACHE_DURATION;
    }
    
    // –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ rebuild –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫
    function scheduleRebuild() {
      if (rebuildTimeout) clearTimeout(rebuildTimeout);
      rebuildTimeout = setTimeout(() => {
        rebuild();
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à –ø–æ—Å–ª–µ rebuild
        saveToCache(CACHE_KEY_ENTRIES, entries);
        saveToCache(CACHE_KEY_SCORES, scores);
        saveToCache(CACHE_KEY_TIMESTAMP, Date.now().toString());
      }, 300); // 300ms –∑–∞–¥–µ—Ä–∂–∫–∞
    }

    // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    infoBtn.addEventListener('click', () => infoModal.classList.add('active'));
    closeModal.addEventListener('click', () => infoModal.classList.remove('active'));
    infoModal.addEventListener('click', (e) => {
      if (e.target === infoModal) infoModal.classList.remove('active');
    });
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    refreshBtn.addEventListener('click', () => {
      refreshBtn.disabled = true;
      refreshBtn.innerHTML = '<div class="loading-spinner" style="width:16px;height:16px;border-width:2px;margin:0;"></div>';
      localStorage.removeItem(CACHE_KEY_TIMESTAMP); // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à
      setupRealtimeListeners();
      setTimeout(() => {
        refreshBtn.disabled = false;
        refreshBtn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;">
              <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
            </svg>`;
        if (unsubscribeEntries) unsubscribeEntries();
        if (unsubscribeScores) unsubscribeScores();
      }, 5000); // 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    });

    const provider = new GoogleAuthProvider();
    signBtn.addEventListener('click', async () => {
      if (!currentUser) {
        try {
          await signInWithPopup(auth, provider);
        } catch(e){ alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + e.message); }
      } else {
        await signOut(auth);
      }
    });

    onAuthStateChanged(auth, user => {
      currentUser = user;
      signBtn.textContent = user ? '–í—ã–π—Ç–∏ (' + (user.email || user.displayName || '') + ')' : '–í–æ–π—Ç–∏';
      adminWrap.classList.toggle('hidden', !(user && user.email === ADMIN_EMAIL));
      
      // –ê–¥–º–∏–Ω –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
      if (user && user.email === ADMIN_EMAIL) {
        setupRealtimeListeners();
      }
    });

    addBtn.addEventListener('click', async () => {
      adminMsg.textContent = '';
      if (!currentUser || currentUser.email !== ADMIN_EMAIL) { adminMsg.textContent = '–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∞'; return; }
      const author = (authorInput.value || '').trim();
      const f = fileInput.files[0];
      if (!author) { adminMsg.textContent = '–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∞–≤—Ç–æ—Ä–∞'; return; }
      if (!f) { adminMsg.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª'; return; }
      adminMsg.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
      const reader = new FileReader();
      reader.onload = async (ev) => {
        try {
          const dataUrl = ev.target.result;
          await addDoc(collection(db, 'contest_entries'), {
            authorName: author,
            skinData: dataUrl,
            createdAt: serverTimestamp()
          });
          adminMsg.textContent = '–î–æ–±–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ';
          authorInput.value = ''; fileInput.value = '';
          // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
          localStorage.removeItem(CACHE_KEY_TIMESTAMP);
          setTimeout(()=> adminMsg.textContent = '',2000);
        } catch(e) {
          console.error(e);
          adminMsg.textContent = '–û—à–∏–±–∫–∞: ' + (e.message||e);
        }
      };
      reader.readAsDataURL(f);
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫—ç—à–∞
    async function loadData() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
      if (isCacheValid()) {
        const cachedEntries = loadFromCache(CACHE_KEY_ENTRIES);
        const cachedScores = loadFromCache(CACHE_KEY_SCORES);
        
        if (cachedEntries && cachedScores) {
          console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ –∫—ç—à–∞');
          entries = cachedEntries;
          scores = cachedScores;
          rebuild();
        }
      }
      
      // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω –∏–ª–∏ –∫—ç—à —É—Å—Ç–∞—Ä–µ–ª)
      if (!isCacheValid() || (currentUser && currentUser.email === ADMIN_EMAIL)) {
        setupRealtimeListeners();
      }
    }
    
    function setupRealtimeListeners() {
      // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫
      if (unsubscribeEntries) unsubscribeEntries();
      if (unsubscribeScores) unsubscribeScores();
      
      console.log('–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Firebase');
      
      const entriesQ = query(collection(db, 'contest_entries'), orderBy('createdAt','desc'));
      unsubscribeEntries = onSnapshot(entriesQ, snap => {
        snap.docChanges().forEach(ch => {
          const id = ch.doc.id;
          if (ch.type === 'removed') {
            delete entries[id];
          } else {
            entries[id] = { id, ...ch.doc.data() };
          }
        });
        scheduleRebuild();
      });

      const scoresQ = query(collection(db, 'contest_scores'), orderBy('createdAt','asc'));
      unsubscribeScores = onSnapshot(scoresQ, snap => {
        // –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏
        snap.docChanges().forEach(ch => {
          const o = ch.doc.data();
          const sid = o.skinId;
          
          if (ch.type === 'removed') {
            if (scores[sid]) {
              scores[sid] = scores[sid].filter(s => s.id !== ch.doc.id);
              if (scores[sid].length === 0) delete scores[sid];
            }
          } else {
            if (!scores[sid]) scores[sid] = [];
            const existingIndex = scores[sid].findIndex(s => s.id === ch.doc.id);
            if (existingIndex >= 0) {
              scores[sid][existingIndex] = { id: ch.doc.id, ...o };
            } else {
              scores[sid].push({ id: ch.doc.id, ...o });
            }
          }
        });
        scheduleRebuild();
      });
    }
    
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–∞–∑ –≤ 10 –º–∏–Ω—É—Ç)
    setInterval(() => {
      if (document.visibilityState === 'visible' && !isCacheValid()) {
        console.log('–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ');
        setupRealtimeListeners();
        // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        setTimeout(() => {
          if (unsubscribeEntries) {
            unsubscribeEntries();
            unsubscribeEntries = null;
          }
          if (unsubscribeScores) {
            unsubscribeScores();
            unsubscribeScores = null;
          }
        }, 10000);
      }
    }, 10 * 60 * 1000);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible' && !isCacheValid()) {
        loadData();
      }
    });

    function rebuild(){
      // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
      previewObserver.disconnect();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫—ç—à–∞
      if (cacheIndicator) {
        const timestamp = localStorage.getItem(CACHE_KEY_TIMESTAMP);
        if (timestamp && isCacheValid()) {
          const minutes = Math.floor((Date.now() - parseInt(timestamp)) / 60000);
          cacheIndicator.textContent = `–ö—ç—à: ${minutes} –º–∏–Ω –Ω–∞–∑–∞–¥`;
        } else {
          cacheIndicator.textContent = '–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ';
        }
      }
      
      const arr = Object.values(entries).map(e => {
        const s = scores[e.id] || [];
        const judgeCount = s.length;
        const sum = s.reduce((a,b)=>a+(b.total||0),0);
        const avgRaw = judgeCount? sum/judgeCount : 0;
        const avgCeil = judgeCount? Math.ceil(avgRaw) : 0;
        return { ...e, judgeCount, judges: s, sum, avgRaw, avgCeil };
      });

      if (!arr.length) {
        listWrap.innerHTML = '';
        podiumSection.style.display = 'none';
        emptyMsg.style.display = 'block';
        return;
      }
      emptyMsg.style.display = 'none';
      
      arr.sort((a,b) => {
        if (b.avgCeil !== a.avgCeil) return b.avgCeil - a.avgCeil;
        return (b.avgRaw || 0) - (a.avgRaw || 0);
      });

      const top3 = arr.slice(0,3);
      const rest = arr.slice(3);

      podiumWrap.innerHTML = '';
      podiumSection.style.display = top3.length ? 'block' : 'none';
      
      top3.forEach((it, idx) => {
        const place = idx + 1;
        const column = document.createElement('div');
        column.className = `podium-column podium-column-${place}`;
        
        column.innerHTML = `
          <div class="podium-medal-single">
            <div class="podium-number podium-number-${place}">${place}</div>
            <div class="podium-medal-label" style="color:${MEDAL_COLORS[idx]};">–º–µ—Å—Ç–æ</div>
          </div>
          <div class="place">
            <div class="place-content">
              <div class="place-preview" id="pv_${it.id}" data-skin-id="${it.id}" data-skin-data="${it.skinData}" data-priority="high">
                <div class="loading-spinner"></div>
              </div>
              <div class="place-author">${escapeHtml(it.authorName || '‚Äî')}</div>
              <div class="place-score">${it.avgCeil} / 90</div>
            </div>
          </div>
        `;
        
        column.querySelector('.place').addEventListener('click', ()=> window.location.href = 'skin.html?id='+it.id);
        podiumWrap.appendChild(column);
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º observer –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        const previewEl = document.getElementById(`pv_${it.id}`);
        if (previewEl) previewObserver.observe(previewEl);
      });

      listWrap.innerHTML = '';
      rest.forEach((it, idx) => {
        const place = idx + 4;
        const card = document.createElement('div');
        card.className = 'card';
        
        let placeDisplay = `<strong style="font-size:1.3rem;">#${place}</strong>`;
        
        card.innerHTML = `
          <div class="thumb" id="thumb_${it.id}" data-skin-id="${it.id}" data-skin-data="${it.skinData}">
            <div class="loading-spinner"></div>
          </div>
          <div class="meta">
            <h2>${escapeHtml(it.authorName || '‚Äî')}</h2>
            <div class="small">–ú–µ—Å—Ç–æ: ${placeDisplay} ‚Ä¢ –û—Ü–µ–Ω–æ–∫: ${it.judgeCount}</div>
            <div class="score-badge">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: ${it.avgCeil} / 90</div>
          </div>
        `;
        card.addEventListener('click', ()=> window.location.href = 'skin.html?id='+it.id);
        listWrap.appendChild(card);
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º observer –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        const thumbEl = document.getElementById(`thumb_${it.id}`);
        if (thumbEl) previewObserver.observe(thumbEl);
      });
    }

    // –ö—ç—à –¥–ª—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–≤—å—é
    const previewCache = new Map();
    
    // –°–µ–º–∞—Ñ–æ—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ä–µ–Ω–¥–µ—Ä–æ–≤
    let activeRenders = 0;
    const MAX_PARALLEL_RENDERS = 3;
    
    // Intersection Observer –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    const previewObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const container = entry.target;
          const skinId = container.dataset.skinId;
          const skinData = container.dataset.skinData;
          const priority = container.dataset.priority === 'high';
          
          if (skinId && skinData && !container.dataset.loaded) {
            container.dataset.loaded = 'true';
            
            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ä–∞–∑—É
            if (priority) {
              init3DPreview(container.id, skinData);
            } else {
              // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
              setTimeout(() => init3DPreview(container.id, skinData), 50);
            }
          }
        }
      });
    }, {
      rootMargin: '200px', // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∑–∞ 200px –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
      threshold: 0.01
    });
    
    async function init3DPreview(containerId, skinDataUrl){
      const container = document.getElementById(containerId);
      if (!container || !skinDataUrl) return;
      
      const isPriority = container.dataset.priority === 'high';
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
      if (previewCache.has(skinDataUrl)) {
        const cachedImg = document.createElement('img');
        cachedImg.src = previewCache.get(skinDataUrl);
        cachedImg.style.width = '100%';
        cachedImg.style.height = '100%';
        cachedImg.style.objectFit = 'cover';
        container.innerHTML = '';
        container.appendChild(cachedImg);
        return;
      }
      
      // –ñ–¥—ë–º —Å–≤–æ–±–æ–¥–Ω—ã–π —Å–ª–æ—Ç –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞
      while (activeRenders >= MAX_PARALLEL_RENDERS) {
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      
      activeRenders++;
      
      try {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫–∏–Ω —Å—Ä–∞–∑—É
        const img = document.createElement('img');
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        img.style.opacity = '0.95';
        img.src = skinDataUrl;
        container.innerHTML = '';
        container.appendChild(img);
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 3D –ø—Ä–µ–≤—å—é
        const off = document.createElement('canvas');
        const isMobile = window.innerWidth <= 640;
        // –¢–æ–ø-3 –ø–æ–ª—É—á–∞—é—Ç –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ
        const targetWidth = isPriority ? (isMobile ? 340 : 400) : (isMobile ? 280 : 320);
        const targetHeight = Math.round(targetWidth * 1.35);
        off.width = targetWidth;
        off.height = targetHeight;
        
        const viewer = new skinview3d.SkinViewer({
          canvas: off,
          width: targetWidth,
          height: targetHeight,
          preserveDrawingBuffer: true
        });
        
        try { viewer.renderer.setClearColor(0x15151c, 1); } catch(_) {}
        
        await viewer.loadSkin(skinDataUrl);
        viewer.zoom = 0.95;
        viewer.autoRotate = false;
        
        try {
          const walk = new skinview3d.WalkingAnimation(viewer);
          walk.speed = 1.0;
          walk.paused = true;
          walk.progress = 0.30;
          viewer.playerObject.rotation.y = -0.4;
          viewer.camera.position.set(0, 24, 46);
          viewer.camera.lookAt(0, 18, 0);
        } catch(e) {
          try { viewer.playerObject.rotation.y = -0.4; } catch(_) {}
        }
        
        await new Promise(res => requestAnimationFrame(() => requestAnimationFrame(res)));
        
        // –¢–æ–ø-3 —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å –ª—É—á—à–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º
        const quality = isPriority ? 0.92 : 0.8;
        const renderedDataUrl = off.toDataURL('image/png', quality);
        previewCache.set(skinDataUrl, renderedDataUrl);
        
        img.src = renderedDataUrl;
        
        try { viewer.dispose(); } catch(e) {}
      } catch(e) {
        console.error('3D preview error:', e);
        const img = document.createElement('img');
        img.src = skinDataUrl;
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        container.innerHTML = '';
        container.appendChild(img);
      } finally {
        activeRenders--;
      }
    }

    function escapeHtml(s){ if (!s && s !== 0) return ''; return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    console.log('–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ Firebase reads –∞–∫—Ç–∏–≤–Ω–∞');
    console.log('–ö—ç—à –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω:', isCacheValid());
    loadData();
  </script>
</body>
</html>
