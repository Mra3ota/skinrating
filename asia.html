<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" href="data:,">
<title>Asia Festival ‚Äî Contest</title>
<style>
  :root {
    --bg: #050505;
    --glass: rgba(20, 20, 25, 0.6);
    --glass-border: rgba(255, 255, 255, 0.1);
    --text: #eaeaf2;
    --muted: #888899;
    --sakura: #ffb7c5;
    --neon-pink: #ff0055;
    --accent: #8a2be2;
  }

  * { box-sizing: border-box; }
  
  body {
    margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; min-height: 100vh;
    background-image: radial-gradient(circle at 15% 50%, rgba(138, 43, 226, 0.15), transparent 25%), radial-gradient(circle at 85% 30%, rgba(255, 0, 85, 0.1), transparent 25%);
    background-attachment: fixed;
  }

  .wrap { max-width: 1400px; margin: 0 auto; position: relative; z-index: 2; }

  /* --- HEADER --- */
  header {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding: 20px;
    background: rgba(20, 20, 25, 0.4); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    border: 1px solid var(--glass-border); border-radius: 24px;
  }
  h1 { margin: 0; font-size: 1.8rem; font-weight: 900; background: linear-gradient(90deg, #fff, var(--sakura)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  
  .btn {
    background: linear-gradient(135deg, var(--accent), #b042ff); color: #fff; padding: 10px 20px; border-radius: 12px;
    text-decoration: none; font-weight: 700; cursor: pointer; border: none; transition: all 0.3s ease; font-size: 0.95rem;
  }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(138, 43, 226, 0.5); }
  .btn-ghost { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); }
  .btn-ghost:hover { background: rgba(255,255,255,0.1); }

  /* --- ADMIN --- */
  .admin-panel {
    background: rgba(255, 0, 85, 0.05); border: 1px dashed var(--neon-pink); border-radius: 20px; padding: 20px; margin-bottom: 30px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;
  }
  .admin-panel input { background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); padding: 10px 15px; border-radius: 10px; color: #fff; }
  .hidden { display: none !important; }

  /* --- GRID --- */
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }

  .card {
    background: var(--glass); backdrop-filter: blur(10px); border: 1px solid var(--glass-border);
    border-radius: 20px; padding: 12px; cursor: pointer; transition: all 0.3s;
    display: flex; flex-direction: column; position: relative; overflow: hidden;
  }
  .card:hover { transform: translateY(-6px); border-color: var(--sakura); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

  .preview-box {
    width: 100%; aspect-ratio: 3/4; background: #0a0a0f; border-radius: 14px;
    overflow: hidden; position: relative; margin-bottom: 12px;
    border: 1px solid rgba(255,255,255,0.05);
  }
  .preview-box img { width: 100%; height: 100%; object-fit: contain; transition: 0.4s; }
  .card:hover .preview-box img { transform: scale(1.05); }
  
  /* Footer Layout (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞) */
  .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding: 4px 2px; }
  
  .card-name { 
    font-weight: 800; font-size: 1.1rem; line-height: 1.2; color: #fff; 
    max-width: 70%; word-break: break-word; text-align: left;
  }
  
  .card-score-box {
    background: rgba(138, 43, 226, 0.2); border: 1px solid var(--accent);
    width: 42px; height: 42px; border-radius: 10px; 
    display: flex; align-items: center; justify-content: center;
    font-weight: 900; font-size: 1.1rem; color: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  /* --- MODAL --- */
  .modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9);
    backdrop-filter: blur(8px); z-index: 100; display: none; align-items: center; justify-content: center;
  }
  .modal-overlay.active { display: flex; animation: fadeIn 0.3s; }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

  .modal-glass {
    width: 90%; max-width: 1100px; height: 85vh; background: #111;
    border: 1px solid var(--glass-border); border-radius: 30px;
    display: grid; grid-template-columns: 1fr 350px; overflow: hidden;
    box-shadow: 0 0 50px rgba(138, 43, 226, 0.2); position: relative;
  }

  .viewer-section { position: relative; background: radial-gradient(circle at center, #1a1a20 0%, #000 100%); }
  .details-section { padding: 30px; border-left: 1px solid var(--glass-border); display: flex; flex-direction: column; background: #0e0e12; }

  .close-btn {
    position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%;
    background: rgba(255,255,255,0.1); border: none; color: #fff; font-size: 1.5rem;
    cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center;
  }
  .close-btn:hover { background: var(--neon-pink); }

  /* Rating Controls */
  .rating-wrap { margin-top: auto; background: rgba(255,255,255,0.03); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
  
  /* –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π –ø–æ–ª–∑—É–Ω–æ–∫ (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ) */
  input[type=range] {
    width: 100%; -webkit-appearance: none; background: transparent; margin: 20px 0; height: 30px; cursor: pointer;
  }
  input[type=range]:focus { outline: none; }
  
  /* –î–æ—Ä–æ–∂–∫–∞ */
  input[type=range]::-webkit-slider-runnable-track {
    width: 100%; height: 8px; background: #444; border-radius: 4px; border: 1px solid #666;
  }
  input[type=range]::-moz-range-track {
    width: 100%; height: 8px; background: #444; border-radius: 4px;
  }
  
  /* –ë–µ–≥—É–Ω–æ–∫ */
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none; height: 28px; width: 28px; border-radius: 50%;
    background: var(--neon-pink); border: 3px solid #fff; margin-top: -11px;
    box-shadow: 0 0 15px var(--neon-pink); transition: transform 0.1s;
  }
  input[type=range]::-moz-range-thumb {
    height: 28px; width: 28px; border-radius: 50%;
    background: var(--neon-pink); border: 3px solid #fff;
    box-shadow: 0 0 15px var(--neon-pink);
  }
  input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

  .big-score {
    font-size: 3.5rem; font-weight: 900; text-align: center; color: #fff;
    text-shadow: 0 0 20px var(--sakura); margin: 5px 0;
  }

  @media (max-width: 900px) {
    .modal-glass { grid-template-columns: 1fr; grid-template-rows: 1fr auto; height: 90vh; }
    .details-section { padding: 20px; overflow-y: auto; }
    .viewer-section { height: 300px; }
  }
</style>
</head>
<body>

<div class="wrap">
  <header>
    <h1><span style="font-size:1.2em;margin-right:8px;">üå∏</span> ASIA FESTIVAL</h1>
    <div style="display:flex; gap:10px;">
      <a href="contests.html" class="btn btn-ghost">‚Üê –ù–∞–∑–∞–¥</a>
      <button id="authBtn" class="btn">–í–æ–π—Ç–∏</button>
    </div>
  </header>

  <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫–∏–Ω–æ–≤ —Å –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø—Ä–µ–≤—å—é -->
  <div id="adminPanel" class="admin-panel hidden">
    <strong style="width:100%;color:var(--neon-pink)">–ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</strong>
    <input type="text" id="newAuthor" placeholder="–ù–∏–∫ –∞–≤—Ç–æ—Ä–∞" style="flex:1">
    <input type="file" id="newFile" accept="image/png" style="display:none">
    <button onclick="document.getElementById('newFile').click()" class="btn btn-ghost">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
    <button id="addEntryBtn" class="btn">–î–æ–±–∞–≤–∏—Ç—å</button>
    <span id="adminStatus" style="font-size:0.9rem; margin-left:10px;"></span>
  </div>

  <div id="grid" class="grid"></div>
  <div id="loading" style="text-align:center; padding: 40px; color:var(--muted)">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div id="modal" class="modal-overlay">
  <button class="close-btn" id="closeModal">√ó</button>
  <div class="modal-glass">
    <div class="viewer-section" id="viewerContainer"></div>
    <div class="details-section">
      <h2 id="mAuthor" style="margin:0 0 5px 0; font-size:2rem;">Author</h2>
      <p style="color:var(--muted); font-size:0.9rem; margin-bottom:20px;">ASIA FESTIVAL ENTRY</p>
      
      <div style="flex:1;">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:8px;">
          <span>–°—É–º–º–∞ –±–∞–ª–ª–æ–≤:</span> <strong id="mTotal" style="color:var(--sakura)">0</strong>
        </div>
        <div id="judgesList" style="font-size:0.9rem; color:var(--muted); max-height:200px; overflow-y:auto;"></div>
      </div>

      <div id="judgeControls" class="rating-wrap hidden">
        <div style="text-align:center; font-weight:bold; margin-bottom:5px; color:var(--muted); font-size:0.8rem;">–í–ê–®–ê –û–¶–ï–ù–ö–ê</div>
        <div class="big-score" id="scoreDisplay">5</div>
        <input type="range" id="scoreInput" min="1" max="10" value="5" step="1">
        <button id="submitScore" class="btn" style="width:100%;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
      
      <div id="judgeError" style="margin-top:20px; text-align:center; color:var(--muted); font-style:italic;" class="hidden">
        –û—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É–¥–µ–π.
      </div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/skinview3d/bundles/skinview3d.bundle.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, doc, getDoc, updateDoc, getDocs, where } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signInWithPopup, signOut, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  // –í–∞–∂–Ω–æ: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º uploadString –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ base64 –ø—Ä–µ–≤—å—é
  import { getStorage, ref, uploadBytesResumable, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

  const firebaseConfig = {
      apiKey: "AIzaSyBTClf2FpsEGwBBP6hFNFV2Zn8DordYLkA",
      authDomain: "skinsrzt.firebaseapp.com",
      projectId: "skinsrzt",
      storageBucket: "skinsrzt.firebasestorage.app",
      messagingSenderId: "1084042281569",
      appId: "1:1084042281569:web:25872944cf7dac7fd66020"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const storage = getStorage(app);
  const ADMIN_EMAIL = "nmprokhorov@gmail.com";

  let currentUser = null;
  let isJudge = false;
  let currentSkinId = null;
  let viewer = null;
  let entries = [];
  let scores = {};

  // DOM
  const grid = document.getElementById('grid');
  const modal = document.getElementById('modal');
  const viewerContainer = document.getElementById('viewerContainer');
  const authBtn = document.getElementById('authBtn');

  // --- AUTH ---
  const provider = new GoogleAuthProvider();
  authBtn.addEventListener('click', async () => {
    if(!currentUser) await signInWithPopup(auth, provider);
    else await signOut(auth);
  });

  onAuthStateChanged(auth, async user => {
    currentUser = user;
    authBtn.textContent = user ? '–í—ã–π—Ç–∏' : '–í–æ–π—Ç–∏';
    document.getElementById('adminPanel').classList.toggle('hidden', !(user && user.email === ADMIN_EMAIL));
    
    if(user) {
      const snap = await getDoc(doc(db, 'judges', user.uid));
      isJudge = snap.exists();
    } else {
      isJudge = false;
    }
    if(currentSkinId) updateModalUI();
  });

  // --- DATA LOADING ---
  onSnapshot(query(collection(db, 'asia_entries'), orderBy('createdAt', 'desc')), snap => {
    entries = [];
    snap.forEach(d => entries.push({id: d.id, ...d.data()}));
    rebuildGrid();
  });

  onSnapshot(collection(db, 'asia_scores'), snap => {
    scores = {};
    snap.forEach(d => {
      const s = d.data();
      if(!scores[s.entryId]) scores[s.entryId] = [];
      scores[s.entryId].push(s);
    });
    rebuildGrid();
    if(currentSkinId) updateModalStats(currentSkinId);
  });

  // --- GRID RENDERING (OPTIMIZED: Just Images) ---
  function rebuildGrid() {
    document.getElementById('loading').style.display = 'none';
    
    const sorted = [...entries].map(e => {
        const entryScores = scores[e.id] || [];
        const total = entryScores.reduce((acc, cur) => acc + cur.score, 0);
        return { ...e, total };
    }).sort((a,b) => b.total - a.total);

    grid.innerHTML = '';
    sorted.forEach(e => {
      const card = document.createElement('div');
      card.className = 'card';
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å –≥–æ—Ç–æ–≤–æ–µ –ø—Ä–µ–≤—å—é (URL), –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ. –ï—Å–ª–∏ –Ω–µ—Ç (—Å—Ç–∞—Ä—ã–µ —Å–∫–∏–Ω—ã), –±–µ—Ä–µ–º —Å–∫–∏–Ω (fallback)
      // –î–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–∫–∏–Ω–æ–≤ —ç—Ç–æ –ø–æ–∫–∞–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä—Ç–∫—É, –Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö –±—É–¥–µ—Ç –∫—Ä–∞—Å–∏–≤–æ–µ 3D –ø—Ä–µ–≤—å—é
      const imgSrc = e.previewUrl || e.skinUrl;
      
      card.innerHTML = `
        <div class="preview-box">
          <img src="${imgSrc}" loading="lazy" style="width:100%;height:100%;object-fit:contain;">
        </div>
        <div class="card-footer">
          <div class="card-name">${escapeHtml(e.authorName)}</div>
          <div class="card-score-box">${e.total}</div>
        </div>
      `;
      card.addEventListener('click', () => openModal(e));
      grid.appendChild(card);
    });
  }

  // --- MODAL LOGIC (Full 3D) ---
  function openModal(entry) {
    currentSkinId = entry.id;
    modal.classList.add('active');
    document.getElementById('mAuthor').textContent = entry.authorName;
    
    if(viewer) viewer.dispose();
    viewerContainer.innerHTML = '';
    const canvas = document.createElement('canvas');
    canvas.style.width = '100%'; canvas.style.height = '100%';
    viewerContainer.appendChild(canvas);
    
    // –í –º–æ–¥–∞–ª–∫–µ –º—ã –≤—Å–µ–≥–¥–∞ –∫—Ä—É—Ç–∏–º —Ä–µ–∞–ª—å–Ω—ã–π —Å–∫–∏–Ω
    viewer = new skinview3d.SkinViewer({
      canvas: canvas,
      width: viewerContainer.clientWidth,
      height: viewerContainer.clientHeight,
      skin: entry.skinUrl
    });
    viewer.autoRotate = true;
    viewer.autoRotateSpeed = 0.5;
    viewer.camera.position.set(0, 20, 50);

    updateModalUI();
    updateModalStats(entry.id);
  }

  function updateModalUI() {
    const controls = document.getElementById('judgeControls');
    const error = document.getElementById('judgeError');
    const input = document.getElementById('scoreInput');
    const disp = document.getElementById('scoreDisplay');

    if(isJudge && currentUser) {
      controls.classList.remove('hidden');
      error.classList.add('hidden');
      
      const entryScores = scores[currentSkinId] || [];
      const myScore = entryScores.find(s => s.judgeId === currentUser.uid);
      if(myScore) {
        input.value = myScore.score;
        disp.textContent = myScore.score;
        document.getElementById('submitScore').textContent = "–û–±–Ω–æ–≤–∏—Ç—å";
      } else {
        input.value = 5;
        disp.textContent = 5;
        document.getElementById('submitScore').textContent = "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å";
      }
    } else {
      controls.classList.add('hidden');
      error.classList.remove('hidden');
    }
  }

  function updateModalStats(id) {
    const entryScores = scores[id] || [];
    const total = entryScores.reduce((acc, cur) => acc + cur.score, 0);
    document.getElementById('mTotal').textContent = total;
    
    document.getElementById('judgesList').innerHTML = entryScores.map(s => 
      `<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.05)">
         <span>${escapeHtml(s.judgeName || '–°—É–¥—å—è')}</span>
         <b style="color:#fff">${s.score}</b>
       </div>`
    ).join('');
  }

  document.getElementById('closeModal').addEventListener('click', () => {
    modal.classList.remove('active');
    if(viewer) { viewer.dispose(); viewer = null; }
    currentSkinId = null;
  });

  const scoreInput = document.getElementById('scoreInput');
  scoreInput.addEventListener('input', (e) => {
    document.getElementById('scoreDisplay').textContent = e.target.value;
  });

  document.getElementById('submitScore').addEventListener('click', async () => {
    if(!currentUser || !isJudge) return;
    const score = parseInt(scoreInput.value);
    const btn = document.getElementById('submitScore');
    btn.disabled = true; btn.textContent = '...';
    
    try {
      let judgeName = currentUser.displayName || '–°—É–¥—å—è';
      const uDoc = await getDoc(doc(db, 'users', currentUser.uid));
      if(uDoc.exists() && uDoc.data().displayName) judgeName = uDoc.data().displayName;
      
      const q = query(collection(db, 'asia_scores'), where('judgeId', '==', currentUser.uid), where('entryId', '==', currentSkinId));
      const snap = await getDocs(q);
      
      if(!snap.empty) {
        await updateDoc(snap.docs[0].ref, { score, judgeName });
      } else {
        await addDoc(collection(db, 'asia_scores'), {
          judgeId: currentUser.uid,
          judgeName,
          entryId: currentSkinId,
          score,
          createdAt: serverTimestamp()
        });
      }
      btn.textContent = '–ì–æ—Ç–æ–≤–æ!';
    } catch(e) { console.error(e); alert(e.message); }
    btn.disabled = false;
  });

  // --- ADMIN UPLOAD: GENERATE PREVIEW ON CLIENT ---
  document.getElementById('addEntryBtn').addEventListener('click', async () => {
    const author = document.getElementById('newAuthor').value;
    const file = document.getElementById('newFile').files[0];
    const status = document.getElementById('adminStatus');
    
    if(!author || !file) return;
    status.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è 3D...';
    
    try {
      // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
      const dataUrl = await generatePreview(file);
      
      status.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...';
      
      // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫–∏–Ω
      const skinRef = ref(storage, `asia-skins/${Date.now()}_${file.name}`);
      const skinTask = await uploadBytesResumable(skinRef, file);
      const skinUrl = await getDownloadURL(skinTask.ref);
      
      // 3. –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç
      const previewRef = ref(storage, `asia-skins/${Date.now()}_preview.png`);
      await uploadString(previewRef, dataUrl, 'data_url');
      const previewUrl = await getDownloadURL(previewRef);
      
      // 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
      await addDoc(collection(db, 'asia_entries'), {
        authorName: author,
        skinUrl: skinUrl,
        previewUrl: previewUrl, // –°—Å—ã–ª–∫–∞ –Ω–∞ –≥–æ—Ç–æ–≤–æ–µ –ø—Ä–µ–≤—å—é
        createdAt: serverTimestamp()
      });
      
      status.textContent = 'OK!';
      document.getElementById('newAuthor').value = '';
      document.getElementById('newFile').value = '';
    } catch(e) {
      status.textContent = 'Error';
      console.error(e);
      alert('–û—à–∏–±–∫–∞: ' + e.message);
    }
  });

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –≤ –ø–∞–º—è—Ç–∏
  async function generatePreview(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = async (e) => {
            const skinData = e.target.result;
            const offCanvas = document.createElement('canvas');
            offCanvas.width = 300;
            offCanvas.height = 400;
            
            const offViewer = new skinview3d.SkinViewer({
                canvas: offCanvas, width: 300, height: 400, preserveDrawingBuffer: true
            });
            
            try {
                offViewer.renderer.setClearColor(0x000000, 0);
                await offViewer.loadSkin(skinData);
                offViewer.zoom = 0.85;
                offViewer.autoRotate = false;
                offViewer.camera.position.set(0, 20, 50);
                offViewer.render();
                
                const dataUrl = offCanvas.toDataURL('image/png');
                offViewer.dispose();
                resolve(dataUrl);
            } catch(err) { reject(err); }
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
  }

  function escapeHtml(text) {
    if (!text) return text;
    return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
  }
  
  window.addEventListener('resize', () => {
    if(viewer && modal.classList.contains('active')) {
       viewer.width = viewerContainer.clientWidth;
       viewer.height = viewerContainer.clientHeight;
    }
  });

</script>
</body>
</html>
