<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<link rel="icon" href="data:,">
<title>Asia Festival ‚Äî Contest</title>
<style>
  :root {
    --bg: #050505;
    --glass: rgba(20, 20, 25, 0.6);
    --glass-border: rgba(255, 255, 255, 0.1);
    --text: #eaeaf2;
    --muted: #888899;
    --sakura: #ffb7c5;
    --neon-pink: #ff0055;
    --accent: #8a2be2;
    
    /* –ú–µ–¥–∞–ª–∏ */
    --gold: #ffd700;
    --silver: #c0c0c0;
    --bronze: #cd7f32;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; min-height: 100vh;
    background-image: radial-gradient(circle at 15% 50%, rgba(138, 43, 226, 0.15), transparent 25%), radial-gradient(circle at 85% 30%, rgba(255, 0, 85, 0.1), transparent 25%);
    background-attachment: fixed;
  }

  .wrap { max-width: 1600px; margin: 0 auto; position: relative; z-index: 2; }

  /* --- HEADER --- */
  header {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding: 20px 30px;
    background: rgba(20, 20, 25, 0.4); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    border: 1px solid var(--glass-border); border-radius: 24px;
  }
  h1 { margin: 0; font-size: 1.8rem; font-weight: 900; background: linear-gradient(90deg, #fff, var(--sakura)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; white-space: nowrap; }
  
  .btn {
    background: linear-gradient(135deg, var(--accent), #b042ff); color: #fff; padding: 10px 20px; border-radius: 12px;
    text-decoration: none; font-weight: 700; cursor: pointer; border: none; transition: all 0.3s ease; font-size: 1rem;
    display: inline-flex; align-items: center; gap: 8px; justify-content: center;
  }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(138, 43, 226, 0.5); }
  .btn-ghost { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); }
  .btn-ghost:hover { background: rgba(255,255,255,0.1); }

  /* --- ADMIN ACCORDION --- */
  .admin-panel {
    background: rgba(255, 0, 85, 0.05); border: 1px dashed var(--neon-pink); border-radius: 20px; 
    margin-bottom: 40px; overflow: hidden; transition: all 0.3s ease;
  }
  
  .admin-header {
    padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
  }
  .admin-header strong { color: var(--neon-pink); display: flex; align-items: center; gap: 10px; }
  .admin-arrow { transition: transform 0.3s ease; font-size: 1.2rem; color: var(--neon-pink); }
  
  .admin-content {
    max-height: 0; opacity: 0; transition: max-height 0.4s ease, opacity 0.3s ease;
    padding: 0 20px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;
  }
  .admin-panel.open .admin-content { max-height: 500px; opacity: 1; padding-bottom: 20px; }
  .admin-panel.open .admin-arrow { transform: rotate(180deg); }

  .admin-panel input { background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); padding: 12px 16px; border-radius: 10px; color: #fff; font-size: 1rem; }
  .hidden { display: none !important; }

  /* --- PODIUM --- */
  .podium-title {
    text-align: center; font-size: 2.5rem; font-weight: 900; margin-bottom: 40px;
    background: linear-gradient(90deg, var(--gold), var(--silver), var(--bronze));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    text-transform: uppercase; letter-spacing: 3px;
    text-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
  }

  .podium-wrapper { 
    display: flex; align-items: flex-end; justify-content: center; gap: 24px; margin-bottom: 60px; 
    flex-wrap: wrap; 
  }
  .podium-column { display: flex; flex-direction: column; align-items: center; transition: transform 0.3s; position: relative; }
  
  .podium-medal-label { font-size: 1.2rem; font-weight: 800; margin-bottom: 12px; text-transform: uppercase; }
  .medal-1 { color: var(--gold); text-shadow: 0 0 10px rgba(255,215,0,0.5); }
  .medal-2 { color: var(--silver); text-shadow: 0 0 10px rgba(192,192,192,0.5); }
  .medal-3 { color: var(--bronze); text-shadow: 0 0 10px rgba(205,127,50,0.5); }

  /* --- PODIUM CARD (FIXED HEIGHT LAYOUT) --- */
  .place-card {
    background: rgba(20, 20, 25, 0.6); backdrop-filter: blur(12px);
    border-radius: 24px; padding: 0;
    border: 2px solid transparent;
    display: flex; flex-direction: column;
    position: relative; cursor: pointer;
    box-shadow: 0 15px 50px rgba(0,0,0,0.6);
    overflow: hidden;
  }
  
  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏: –°—Ç—Ä–æ–≥–æ 82% –≤—ã—Å–æ—Ç—ã, —á—Ç–æ–±—ã –Ω–æ–≥–∏ –Ω–µ —Ä–µ–∑–∞–ª–∏—Å—å */
  .place-img-box {
      height: 88%; 
      width: 100%;
      position: relative;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding: 10px 15px 0 15px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), transparent);
  }

  .place-img-box img { 
    max-width: 100%; 
    height: 100%;
    object-fit: contain; 
    object-position: center bottom;
    image-rendering: pixelated;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
  }
  
  .place-card:hover img { transform: scale(1.1) translateY(-10px); }

  /* –ò–Ω—Ñ–æ-–±–ª–æ–∫: –°—Ç—Ä–æ–≥–æ –≤–Ω–∏–∑—É, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
  .place-info { 
    height: 12%;
    width: 100%; 
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    background: rgba(0,0,0,0.6); /* –¢–µ–º–Ω–µ–µ —Ñ–æ–Ω */
    border-top: 1px solid rgba(255,255,255,0.05);
    z-index: 5;
  }
  .place-name { font-weight: 800; font-size: 1.3rem; margin-bottom: 2px; color: #fff; line-height: 1; }
  .place-score { font-weight: 900; font-size: 1.1rem; color: var(--sakura); line-height: 1; margin-top: 4px; }

  /* --- SIZES (PC) --- */
  .col-1 { order: 2; z-index: 3; }
  .col-1 .place-card { width: 320px; height: 450px; border-color: var(--gold); } /* –ß—É—Ç—å –≤—ã—à–µ */
  
  .col-2 { order: 1; z-index: 2; }
  .col-2 .place-card { width: 270px; height: 380px; border-color: var(--silver); }
  
  .col-3 { order: 3; z-index: 2; }
  .col-3 .place-card { width: 270px; height: 380px; border-color: var(--bronze); }


  /* --- GRID (LIST 4+) --- */
  .grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); 
    gap: 20px; 
  }

  .card {
    background: var(--glass); backdrop-filter: blur(10px); border: 1px solid var(--glass-border);
    border-radius: 20px; padding: 12px; cursor: pointer; transition: all 0.3s;
    display: flex; flex-direction: column; position: relative; overflow: hidden;
  }
  .card:hover { transform: translateY(-5px); border-color: var(--accent); }

  .rank-badge {
    position: absolute; top: 12px; left: 12px; z-index: 2;
    background: rgba(0,0,0,0.8); color: #fff;
    font-weight: 800; font-size: 0.9rem; padding: 4px 10px; border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.15);
  }

  .preview-box {
    width: 100%; 
    aspect-ratio: 1 / 1.2;
    background: #0a0a0f; border-radius: 16px;
    overflow: hidden; position: relative; margin-bottom: 12px;
    border: 1px solid rgba(255,255,255,0.05);
    display: flex; align-items: flex-end; justify-content: center;
  }
  .preview-box img { 
      width: 100%; height: 100%; 
      object-fit: contain; 
      object-position: center bottom;
      transition: 0.4s; display: block; 
      image-rendering: pixelated; 
  }
  
  .card-footer { display: flex; justify-content: space-between; align-items: center; padding: 0 4px; }
  
  .card-name { 
    font-weight: 700; font-size: 1.1rem; line-height: 1.1; color: #fff; 
    max-width: 70%; word-break: break-word; text-align: left;
    overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
  }
  
  .card-score-box {
    background: rgba(138, 43, 226, 0.2); border: 1px solid var(--accent);
    width: 40px; height: 40px; border-radius: 10px; 
    display: flex; align-items: center; justify-content: center;
    font-weight: 900; font-size: 1rem; color: #fff;
  }

  /* --- MOBILE OPTIMIZATIONS --- */
  @media (max-width: 768px) {
    body { padding: 12px; }
    header { padding: 12px 16px; margin-bottom: 20px; }
    h1 { font-size: 1.2rem; }
    
    @media (max-width: 400px) {
        .logout-text { display: none; } 
        .btn { padding: 8px; }
    }

    /* Podium */
    .podium-wrapper { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 10px; 
        align-items: start;
    }
    .col-1 { 
        grid-column: 1 / -1; 
        order: 1; 
        margin-bottom: 10px; 
        width: 100%; 
        display: flex; 
        justify-content: center;
    }
    .col-1 .place-card { 
        width: 100%; 
        max-width: 240px; 
        height: 340px; /* –ï—â–µ –≤—ã—à–µ –¥–ª—è –º–æ–±–∏–ª–∫–∏ */
    }
    
    .col-2 { grid-column: 1; order: 2; width: 100%; }
    .col-2 .place-card { width: 100%; height: 280px; }
    
    .col-3 { grid-column: 2; order: 3; width: 100%; }
    .col-3 .place-card { width: 100%; height: 280px; }

    /* –¢–µ–∫—Å—Ç —á—É—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –Ω–∞ –º–æ–±–∏–ª–∫–µ */
    .place-name { font-size: 1.1rem; }
    .place-score { font-size: 1rem; }
    
    /* --- LIST (4+) --- */
    .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }
    
    .card {
        flex-direction: column;
        padding: 8px;
    }

    .preview-box {
        aspect-ratio: 1 / 1.3; 
        border-radius: 12px;
        margin-bottom: 8px;
    }

    .preview-box img {
        object-fit: contain; 
        object-position: center bottom;
    }

    .card-footer { padding: 0 4px; }
    .card-name { font-size: 0.9rem; }
    .card-score-box { width: 32px; height: 32px; font-size: 0.9rem; }
  }

  /* --- MODAL --- */
  .modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9);
    backdrop-filter: blur(8px); z-index: 100; display: none; align-items: center; justify-content: center;
  }
  .modal-overlay.active { display: flex; animation: fadeIn 0.2s; }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

  .modal-glass {
    width: 90%; max-width: 1100px; height: 85vh; background: #111;
    border: 1px solid var(--glass-border); border-radius: 24px;
    display: grid; grid-template-columns: 1fr 350px; overflow: hidden;
    position: relative;
  }

  .viewer-section { position: relative; background: radial-gradient(circle at center, #1a1a20 0%, #000 100%); }
  .details-section { padding: 24px; border-left: 1px solid var(--glass-border); display: flex; flex-direction: column; background: #0e0e12; }

  .close-btn {
    position: absolute; top: 15px; right: 15px; width: 36px; height: 36px; border-radius: 50%;
    background: rgba(255,255,255,0.15); border: none; color: #fff; font-size: 1.5rem;
    cursor: pointer; z-index: 20; display: flex; align-items: center; justify-content: center;
  }

  /* Rating Controls */
  .rating-wrap { margin-top: auto; background: rgba(255,255,255,0.03); padding: 16px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
  
  input[type=range] { 
    width: 100%; 
    -webkit-appearance: none; 
    -moz-appearance: none;
    appearance: none;
    background: transparent; 
    margin: 15px 0; 
    height: 30px; 
    cursor: pointer; 
  }

  /* –¢—Ä–µ–∫ –¥–ª—è WebKit (Chrome, Safari, Edge) */
  input[type=range]::-webkit-slider-runnable-track { 
    width: 100%; 
    height: 8px; 
    background: #444; 
    border-radius: 4px; 
  }

  /* –ü–æ–ª–∑—É–Ω–æ–∫ –¥–ª—è WebKit */
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none; 
    height: 28px; 
    width: 28px; 
    border-radius: 50%;
    background: var(--neon-pink); 
    border: 3px solid #fff; 
    margin-top: -11px;
    box-shadow: 0 0 15px var(--neon-pink);
  }

  /* –¢—Ä–µ–∫ –¥–ª—è Firefox */
  input[type=range]::-moz-range-track {
    width: 100%;
    height: 8px;
    background: #444;
    border-radius: 4px;
    border: none;
  }

  /* –ü–æ–ª–∑—É–Ω–æ–∫ –¥–ª—è Firefox */
  input[type=range]::-moz-range-thumb {
    height: 22px;
    width: 22px;
    border-radius: 50%;
    background: var(--neon-pink);
    border: 3px solid #fff;
    box-shadow: 0 0 15px var(--neon-pink);
    cursor: pointer;
  }

  .big-score {
    font-size: 3rem; font-weight: 900; text-align: center; color: #fff;
    text-shadow: 0 0 20px var(--sakura); margin: 5px 0;
  }

  @media (max-width: 900px) {
    .modal-glass { 
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr;
      height: 92vh;
      max-height: none;
    }

    .viewer-section { 
      min-height: 280px;
      max-height: 400px;
      height: 45vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
    }

    .details-section { 
      padding: 12px 16px;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ */
    #mAuthor {
      font-size: 1.2rem !important;
      margin-bottom: 3px !important;
    }

    .rating-wrap {
      margin-top: 10px;
      padding: 12px;
    }

    .big-score {
      font-size: 2.5rem;
      margin: 3px 0;
    }
  }


  /* ============================================ */
  /* MOBILE OPTIMIZATION */
  /* ============================================ */

  @media (max-width: 900px) {
    header { flex-direction: column; align-items: flex-start; gap: 16px; }
    .header-right { width: 100%; justify-content: space-between; }
  }

  @media (max-width: 768px) {
    .wrap { padding: 16px; max-width: 100%; }
    .grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
    .card { padding: 10px; border-radius: 16px; }
    .card-title { font-size: 0.85rem; margin-top: 8px; }
    .btn { min-height: 48px; padding: 12px 18px; font-size: 0.95rem; }
    #adminWrap { padding: 16px; border-radius: 16px; }
  }

  @media (max-width: 480px) {
    .wrap { padding: 12px; }
    .grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .card { padding: 8px; }
    .card-title { font-size: 0.8rem; }
    header h1 { font-size: 1.5rem; }
    .btn { padding: 10px 14px; font-size: 0.9rem; }
  }

  @media (max-width: 400px) {
    .grid { gap: 8px; }
    .card { padding: 6px; border-radius: 12px; }
    header h1 { font-size: 1.3rem; }
  }

  /* Modal optimization */
  .eval-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(12px); z-index: 9999; display: none; align-items: center; justify-content: center;
    padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
  .eval-modal.active { display: flex; }
  .eval-content { background: var(--glass); border: 1px solid var(--glass-border); border-radius: 24px;
    padding: 24px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; }
  .eval-slider { width: 100%; height: 48px; background: transparent; cursor: pointer;
    -webkit-appearance: none; appearance: none; }
  .eval-slider::-webkit-slider-track { width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; }
  .eval-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 28px; height: 28px; border-radius: 50%;
    background: linear-gradient(135deg, var(--sakura), var(--neon-pink)); cursor: pointer;
    box-shadow: 0 4px 12px rgba(255, 183, 197, 0.5); transition: transform 0.2s; }
  .eval-slider::-webkit-slider-thumb:active { transform: scale(1.2); }
  .eval-slider::-moz-range-thumb { width: 28px; height: 28px; border-radius: 50%;
    background: linear-gradient(135deg, var(--sakura), var(--neon-pink)); border: none;
    box-shadow: 0 4px 12px rgba(255, 183, 197, 0.5); }

  @media (max-width: 768px) {
    .eval-modal { padding: 12px; align-items: flex-start; }
    .eval-content { padding: 20px 16px; margin-top: 20px; }
    .eval-slider { height: 52px; }
    .eval-slider::-webkit-slider-thumb { width: 32px; height: 32px; }
    .eval-slider::-moz-range-thumb { width: 32px; height: 32px; }
  }


  /* === –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ú–û–ë–ò–õ–¨–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø === */

  /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
  @media (max-width: 768px) {
    #skinDetailModal {
      padding: 0.5rem !important;
      overflow-y: auto !important;
      -webkit-overflow-scrolling: touch !important;
      align-items: flex-start !important;
      padding-top: 2rem !important;
    }

    #skinDetailModal .modal-content {
      width: 95vw !important;
      max-width: 95vw !important;
      max-height: 90vh !important;
      overflow-y: auto !important;
      padding: 1.5rem 1rem !important;
      margin: 0 !important;
      position: relative !important;
    }

    /* 3D –ø—Ä–µ–≤—å—é —Å–∫–∏–Ω–∞ */
    .skin-3d-preview,
    #skinPreview {
      width: 200px !important;
      height: 280px !important;
      margin: 0 auto 1.5rem auto !important;
    }

    /* –≠–ª–µ–º–µ–Ω—Ç—ã –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è –¥–ª—è —Å—É–¥–µ–π */
    #judgeRatingSection select,
    .judge-rating select,
    select[id*="judgeScore"] {
      width: 100% !important;
      font-size: 1.15rem !important;
      padding: 0.9rem !important;
      margin: 0.5rem 0 !important;
      touch-action: manipulation !important;
      border-radius: 0.75rem !important;
    }

    #judgeRatingSection button,
    .judge-rating button,
    button[onclick*="submitRating"] {
      width: 100% !important;
      font-size: 1.15rem !important;
      padding: 1rem !important;
      margin-top: 0.8rem !important;
      touch-action: manipulation !important;
      border-radius: 0.75rem !important;
      min-height: 48px !important;
    }

    /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ */
    .modal-close,
    button[onclick*="close"] {
      font-size: 2rem !important;
      padding: 0.4rem 0.8rem !important;
      top: 0.5rem !important;
      right: 0.5rem !important;
      z-index: 10001 !important;
      touch-action: manipulation !important;
      min-width: 44px !important;
      min-height: 44px !important;
    }

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–∏–Ω–µ */
    .skin-info-detail h3,
    #detailTitle {
      font-size: 1.4rem !important;
      line-height: 1.3 !important;
      margin-bottom: 0.8rem !important;
    }

    .skin-info-detail p,
    #detailAuthor,
    #detailScore {
      font-size: 1.1rem !important;
      line-height: 1.5 !important;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ –≤ —Å–µ—Ç–∫–µ */
    .grid-card {
      padding: 1rem !important;
    }

    .grid-card img {
      width: 100% !important;
      height: auto !important;
    }
  }

  /* –≠–∫—Å—Ç—Ä–∞-–º–∞–ª—ã–µ —ç–∫—Ä–∞–Ω—ã */
  @media (max-width: 480px) {
    #skinDetailModal .modal-content {
      width: 98vw !important;
      padding: 1.2rem 0.8rem !important;
    }

    .skin-3d-preview,
    #skinPreview {
      width: 160px !important;
      height: 240px !important;
    }

    #judgeRatingSection select,
    .judge-rating select {
      font-size: 1.05rem !important;
      padding: 0.8rem !important;
    }

    #judgeRatingSection button,
    .judge-rating button {
      font-size: 1.05rem !important;
      padding: 0.9rem !important;
    }
  }

  /* –§–∏–∫—Å –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–∫—Ä–æ–ª–ª–∞ body –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –º–æ–¥–∞–ª–∫–µ */
  body.modal-open {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
  }

</style>
</head>
<body>

<div class="wrap">
  <header>
    <h1><span style="font-size:1.2em;margin-right:8px;">üå∏</span> ASIA FESTIVAL</h1>
    <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      <a href="contests.html" class="btn btn-ghost">‚Üê</a>
      <button id="privacyToggleBtn" class="btn" style="display: none; background: rgba(74, 222, 128, 0.15); border: 1px solid rgba(74, 222, 128, 0.3); color: #4ade80; gap: 8px;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <span id="privacyStatusText">üëÅÔ∏è –ü—É–±–ª–∏—á–Ω—ã–π</span>
      </button>
      <button id="authBtn" class="btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
        <span class="logout-text">–í–æ–π—Ç–∏</span>
      </button>
    </div>
  </header>

  <!-- Admin Accordion -->
  <div id="adminPanel" class="admin-panel hidden">
    <div class="admin-header" onclick="document.getElementById('adminPanel').classList.toggle('open')">
        <strong>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
            –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨
        </strong>
        <span class="admin-arrow">‚ñº</span>
    </div>
    <div class="admin-content">
        <input type="text" id="newAuthor" placeholder="–ù–∏–∫ –∞–≤—Ç–æ—Ä–∞" style="flex:1; min-width:150px;">
        <input type="file" id="newFile" accept="image/png" style="display:none">
        <button onclick="document.getElementById('newFile').click()" class="btn btn-ghost">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
        <button id="addEntryBtn" class="btn">–î–æ–±–∞–≤–∏—Ç—å</button>
        <span id="adminStatus" style="font-size:0.9rem; margin-left:10px;"></span>
    </div>
  </div>

  <!-- Podium -->
  <div id="podiumSection" class="hidden">
    <div class="podium-title">–ü–†–ò–ó–Å–†–´</div>
    <div id="podiumWrapper" class="podium-wrapper"></div>
  </div>

  <!-- Grid -->
  <div id="grid" class="grid"></div>
  <div id="loading" style="text-align:center; padding: 40px; color:var(--muted)">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<!-- Modal -->
<div id="modal" class="modal-overlay">
  <div class="modal-glass">
    <button class="close-btn" id="closeModal">√ó</button>
    <div class="viewer-section" id="viewerContainer"></div>
    <div class="details-section">
      <h2 id="mAuthor" style="margin:0 0 5px 0; font-size:1.5rem;">Author</h2>
      <p style="color:var(--muted); font-size:0.8rem; margin-bottom:15px;">ASIA FESTIVAL ENTRY</p>
      
      <div style="flex:1; overflow-y:auto; margin-bottom:10px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:8px;">
          <span>–°—É–º–º–∞ –±–∞–ª–ª–æ–≤:</span> <strong id="mTotal" style="color:var(--sakura)">0</strong>
        </div>
        <div id="judgesList" style="font-size:0.85rem; color:var(--muted);"></div>
      </div>

      <div id="judgeControls" class="rating-wrap hidden">
        <div style="text-align:center; font-weight:bold; margin-bottom:5px; color:var(--muted); font-size:0.75rem;">–í–ê–®–ê –û–¶–ï–ù–ö–ê</div>
        <div class="big-score" id="scoreDisplay">5</div>
        <input type="range" id="scoreInput" min="1" max="10" value="5" step="1">
        <button id="submitScore" class="btn" style="width:100%;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
      </div>
      
      <div id="judgeError" style="margin-top:10px; text-align:center; color:var(--muted); font-style:italic; font-size:0.85rem;" class="hidden">
        –û—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É–¥–µ–π.
      </div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/skinview3d/bundles/skinview3d.bundle.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, doc, getDoc, updateDoc, getDocs, where } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signInWithPopup, signOut, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getStorage, ref, uploadBytesResumable, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

  const firebaseConfig = {
      apiKey: "AIzaSyBTClf2FpsEGwBBP6hFNFV2Zn8DordYLkA",
      authDomain: "skinsrzt.firebaseapp.com",
      projectId: "skinsrzt",
      storageBucket: "skinsrzt.firebasestorage.app",
      messagingSenderId: "1.084042281569e+12",
      appId: "1:1.084042281569e+12:web:25872944cf7dac7fd66020"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const storage = getStorage(app);
  const ADMIN_EMAIL = "nmprokhorov@gmail.com";

  let currentUser = null;
  let isJudge = false;
  let currentSkinId = null;
  let viewer = null;
  let entries = [];
  let scores = {};

  // DOM
  const grid = document.getElementById('grid');
  const podiumSection = document.getElementById('podiumSection');
  const podiumWrapper = document.getElementById('podiumWrapper');
  const modal = document.getElementById('modal');
  const viewerContainer = document.getElementById('viewerContainer');
  const authBtn = document.getElementById('authBtn');

  const MEDAL_LABELS = ['1 –ú–ï–°–¢–û', '2 –ú–ï–°–¢–û', '3 –ú–ï–°–¢–û'];
  const MEDAL_CLASSES = ['medal-1', 'medal-2', 'medal-3'];

  // --- AUTH ---
  const provider = new GoogleAuthProvider();
  authBtn.addEventListener('click', async () => {
    if(!currentUser) await signInWithPopup(auth, provider);
    else await signOut(auth);
  });

  onAuthStateChanged(auth, async user => {
    currentUser = user;
    // Update only the text span, keep the icon
    const txtSpan = authBtn.querySelector('.logout-text');
    if(txtSpan) txtSpan.textContent = user ? '–í—ã–π—Ç–∏' : '–í–æ–π—Ç–∏';
    
    document.getElementById('adminPanel').classList.toggle('hidden', !(user && user.email === ADMIN_EMAIL));
    
    if(user) {
      const snap = await getDoc(doc(db, 'judges', user.uid));
      isJudge = snap.exists();
    } else {
      isJudge = false;
    }
    if(currentSkinId) updateModalUI();
  });

  // --- DATA ---
  onSnapshot(query(collection(db, 'asia_entries'), orderBy('createdAt', 'desc')), snap => {
    entries = [];
    snap.forEach(d => entries.push({id: d.id, ...d.data()}));
    rebuildAll();
  });

  onSnapshot(collection(db, 'asia_scores'), snap => {
    scores = {};
    snap.forEach(d => {
      const s = d.data();
      if(!scores[s.entryId]) scores[s.entryId] = [];
      scores[s.entryId].push(s);
    });
    rebuildAll();
    if(currentSkinId) updateModalStats(currentSkinId);
  });

  // --- RENDER ---
  function rebuildAll() {
    document.getElementById('loading').style.display = 'none';
    
    const sorted = [...entries].map(e => {
        const entryScores = scores[e.id] || [];
        const total = entryScores.reduce((acc, cur) => acc + cur.score, 0);
        return { ...e, total };
    }).sort((a,b) => b.total - a.total);

    const podiumList = sorted.slice(0, 3);
    const gridList = sorted.slice(3);

    renderPodium(podiumList);
    renderGrid(gridList);
  }

  function renderPodium(list) {
    if(list.length === 0) {
        podiumSection.classList.add('hidden');
        return;
    }
    podiumSection.classList.remove('hidden');
    podiumWrapper.innerHTML = '';

    const order = [1, 0, 2]; 
    order.forEach(idx => {
        if(!list[idx]) return;
        const e = list[idx];
        const place = idx + 1;
        const col = document.createElement('div');
        col.className = `podium-column col-${place}`;
        const imgSrc = e.previewUrl || e.skinUrl;

        col.innerHTML = `
            <div class="podium-medal-label ${MEDAL_CLASSES[idx]}">${MEDAL_LABELS[idx]}</div>
            <div class="place-card">
                <div class="place-img-box">
                    <img src="${imgSrc}" loading="lazy">
                </div>
                <div class="place-info">
                    <div class="place-name">${escapeHtml(e.authorName)}</div>
                    <div class="place-score">${e.total}</div>
                </div>
            </div>
        `;
        col.querySelector('.place-card').addEventListener('click', () => openModal(e));
        podiumWrapper.appendChild(col);
    });
  }

  function renderGrid(list) {
    grid.innerHTML = '';
    list.forEach((e, index) => {
      const card = document.createElement('div');
      card.className = 'card';
      const imgSrc = e.previewUrl || e.skinUrl;
      const rank = index + 4; 
      
      card.innerHTML = `
        <div class="rank-badge">#${rank}</div>
        <div class="preview-box">
          <img src="${imgSrc}" loading="lazy">
        </div>
        <div class="card-footer">
          <div class="card-name">${escapeHtml(e.authorName)}</div>
          <div class="card-score-box">${e.total}</div>
        </div>
      `;
      card.addEventListener('click', () => openModal(e));
      grid.appendChild(card);
    });
  }

  // --- MODAL ---
  function openModal(entry) {
    currentSkinId = entry.id;
    modal.classList.add('active');
    document.getElementById('mAuthor').textContent = entry.authorName;
    
    if(viewer) viewer.dispose();
    viewerContainer.innerHTML = '';
    const canvas = document.createElement('canvas');
    canvas.style.width = '100%'; canvas.style.height = '100%';
    viewerContainer.appendChild(canvas);
    
    viewer = new skinview3d.SkinViewer({
      canvas: canvas, width: viewerContainer.clientWidth, height: viewerContainer.clientHeight, skin: entry.skinUrl
    });
    viewer.autoRotate = true; viewer.autoRotateSpeed = 0.5; viewer.camera.position.set(0, 20, 50);

    updateModalUI();
    updateModalStats(entry.id);
  
    // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª body –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
    document.body.classList.add('modal-open');
}

  function updateModalUI() {
    const controls = document.getElementById('judgeControls');
    const error = document.getElementById('judgeError');
    const input = document.getElementById('scoreInput');
    const disp = document.getElementById('scoreDisplay');

    if(isJudge && currentUser) {
      controls.classList.remove('hidden');
      error.classList.add('hidden');
      const entryScores = scores[currentSkinId] || [];
      const myScore = entryScores.find(s => s.judgeId === currentUser.uid);
      if(myScore) {
        input.value = myScore.score; disp.textContent = myScore.score;
        document.getElementById('submitScore').textContent = "–û–±–Ω–æ–≤–∏—Ç—å";
      } else {
        input.value = 5; disp.textContent = 5;
        document.getElementById('submitScore').textContent = "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å";
      }
    } else {
      controls.classList.add('hidden');
      error.classList.remove('hidden');
    }
  }

  function updateModalStats(id) {
    const entryScores = scores[id] || [];
    const total = entryScores.reduce((acc, cur) => acc + cur.score, 0);
    document.getElementById('mTotal').textContent = total;
    document.getElementById('judgesList').innerHTML = entryScores.map(s => 
      `<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.05)"><span>${escapeHtml(s.judgeName||'–°—É–¥—å—è')}</span><b style="color:#fff">${s.score}</b></div>`
    ).join('');
  }

  document.getElementById('closeModal').addEventListener('click', () => {
    modal.classList.remove('active');
    if(viewer) { viewer.dispose(); viewer = null; }
    currentSkinId = null;
  });

  const scoreInput = document.getElementById('scoreInput');
  scoreInput.addEventListener('input', (e) => { document.getElementById('scoreDisplay').textContent = e.target.value; });

  document.getElementById('submitScore').addEventListener('click', async () => {
    if(!currentUser || !isJudge) return;
    const score = parseInt(scoreInput.value);
    const btn = document.getElementById('submitScore');
    btn.disabled = true; btn.textContent = '...';
    try {
      let judgeName = currentUser.displayName || '–°—É–¥—å—è';
      const uDoc = await getDoc(doc(db, 'users', currentUser.uid));
      if(uDoc.exists() && uDoc.data().displayName) judgeName = uDoc.data().displayName;
      
      const q = query(collection(db, 'asia_scores'), where('judgeId', '==', currentUser.uid), where('entryId', '==', currentSkinId));
      const snap = await getDocs(q);
      
      if(!snap.empty) await updateDoc(snap.docs[0].ref, { score, judgeName });
      else await addDoc(collection(db, 'asia_scores'), {
          judgeId: currentUser.uid, judgeName, entryId: currentSkinId, score, createdAt: serverTimestamp()
      });
      btn.textContent = '–ì–æ—Ç–æ–≤–æ!';
    } catch(e) { console.error(e); alert(e.message); }
    btn.disabled = false;
  });

  // --- GENERATE HIGH-RES PREVIEW ---
  async function generatePreview(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = async (e) => {
            const skinData = e.target.result;
            const offCanvas = document.createElement('canvas');
            offCanvas.width = 600;
            offCanvas.height = 700; 
            
            const offViewer = new skinview3d.SkinViewer({
                canvas: offCanvas, width: 600, height: 700, preserveDrawingBuffer: true
            });
            
            try {
                offViewer.renderer.setClearColor(0x000000, 0);
                await offViewer.loadSkin(skinData);
                
                offViewer.zoom = 1.0; 
                offViewer.autoRotate = false;
                offViewer.playerObject.rotation.y = -0.5;
                offViewer.camera.position.set(0, 25, 40); 
                offViewer.camera.lookAt(0, 12, 0);
                
                offViewer.render();
                const dataUrl = offCanvas.toDataURL('image/png');
                offViewer.dispose();
                resolve(dataUrl);
            } catch(err) { reject(err); }
        };
        reader.readAsDataURL(file);
    });
  }

  document.getElementById('addEntryBtn').addEventListener('click', async () => {
    const author = document.getElementById('newAuthor').value;
    const file = document.getElementById('newFile').files[0];
    const status = document.getElementById('adminStatus');
    if(!author || !file) return;
    status.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
    
    try {
      const dataUrl = await generatePreview(file); 
      status.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
      const skinRef = ref(storage, `asia-skins/${Date.now()}_${file.name}`);
      const skinTask = await uploadBytesResumable(skinRef, file);
      const skinUrl = await getDownloadURL(skinTask.ref);
      
      const previewRef = ref(storage, `asia-skins/${Date.now()}_preview.png`);
      await uploadString(previewRef, dataUrl, 'data_url');
      const previewUrl = await getDownloadURL(previewRef);
      
      await addDoc(collection(db, 'asia_entries'), {
        authorName: author, skinUrl: skinUrl, previewUrl: previewUrl, createdAt: serverTimestamp()
      });
      status.textContent = 'OK!';
      document.getElementById('newAuthor').value = '';
    } catch(e) { status.textContent = 'Error'; console.error(e); }
  });

  function escapeHtml(text) { return text ? text.replace(/&/g, "&amp;").replace(/</g, "&lt;") : ''; }
  window.addEventListener('resize', () => { if(viewer && modal.classList.contains('active')) { viewer.width = viewerContainer.clientWidth; viewer.height = viewerContainer.clientHeight; } });


// ============================================
// PRIVACY SYSTEM
// ============================================
const privacyToggleBtn = document.getElementById('privacyToggleBtn');
const privacyStatusText = document.getElementById('privacyStatusText');
let contestIsPrivate = false;
const CONTEST_ID = 'asia-festival';

async function loadPrivacyStatus() {
    try {
        const contestRef = doc(db, 'contests', CONTEST_ID);
        const contestDoc = await getDoc(contestRef);
        if (contestDoc.exists()) {
            contestIsPrivate = contestDoc.data().isPrivate || false;
            updatePrivacyUI();
        }
    } catch(e) { console.error('Privacy load error:', e); }
}

privacyToggleBtn.addEventListener('click', async () => {
    if (!currentUser) return;
    const newState = !contestIsPrivate;
    const confirmMsg = newState ? 'üîí –°–∫—Ä—ã—Ç—å –∫–æ–Ω–∫—É—Ä—Å –æ—Ç –ø—É–±–ª–∏–∫–∏?\n\n–í–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É –∏ —Å—É–¥—å—è–º.' : 'üëÅÔ∏è –°–¥–µ–ª–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å –ø—É–±–ª–∏—á–Ω—ã–º?';
    if (!confirm(confirmMsg)) return;

    privacyToggleBtn.disabled = true;
    privacyStatusText.textContent = '‚è≥';

    try {
        const contestRef = doc(db, 'contests', CONTEST_ID);
        const contestDoc = await getDoc(contestRef);

        if (contestDoc.exists()) {
            await updateDoc(contestRef, { isPrivate: newState, updatedAt: serverTimestamp() });
        } else {
            await setDoc(contestRef, { id: CONTEST_ID, name: 'Asia Festival', isPrivate: newState, createdAt: serverTimestamp() });
        }

        contestIsPrivate = newState;
        updatePrivacyUI();
        alert(newState ? '‚úÖ –ö–æ–Ω–∫—É—Ä—Å —Å–∫—Ä—ã—Ç' : '‚úÖ –ö–æ–Ω–∫—É—Ä—Å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω');
        loadData();
      updatePrivacyButtonVisibility();
      checkContentVisibility();
    } catch(e) {
        alert('–û—à–∏–±–∫–∞: ' + e.message);
    } finally {
        privacyToggleBtn.disabled = false;
    }
});

function updatePrivacyUI() {
    if (contestIsPrivate) {
        privacyToggleBtn.style.background = 'rgba(239, 68, 68, 0.15)';
        privacyToggleBtn.style.borderColor = 'rgba(239, 68, 68, 0.3)';
        privacyToggleBtn.style.color = '#ef4444';
        privacyStatusText.textContent = 'üîí –ü—Ä–∏–≤–∞—Ç–Ω—ã–π';
    } else {
        privacyToggleBtn.style.background = 'rgba(74, 222, 128, 0.15)';
        privacyToggleBtn.style.borderColor = 'rgba(74, 222, 128, 0.3)';
        privacyToggleBtn.style.color = '#4ade80';
        privacyStatusText.textContent = 'üëÅÔ∏è –ü—É–±–ª–∏—á–Ω—ã–π';
    }
}

function checkContentVisibility() {
    if (contestIsPrivate) {
        const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å —Å—É–¥—å–∏ —á–µ—Ä–µ–∑ Firebase
        if (currentUser && !isAdmin) {
            checkIfJudge(currentUser.uid, (isJudge) => {
                if (!isJudge) {
                    const contentWrap = document.getElementById('contentWrap');
                    if (contentWrap) contentWrap.style.display = 'none';

                    const msg = document.createElement('div');
                    msg.style.cssText = 'text-align: center; padding: 4rem 2rem; color: var(--muted);';
                    msg.innerHTML = '<h2 style="color: var(--sakura); margin-bottom: 1rem; text-shadow: 0 2px 18px var(--neon-pink);">üîí –ö–æ–Ω–∫—É—Ä—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫—Ä—ã—Ç</h2><p style="font-size: 1.15rem;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–∑–∂–µ</p>';

                    const wrap = document.querySelector('.wrap');
                    if (wrap && !wrap.querySelector('.privacy-message')) {
                        msg.className = 'privacy-message';
                        wrap.appendChild(msg);
                    }
                    return;
                }
            });
        } else if (isAdmin) {
            // –ê–¥–º–∏–Ω - –≤—Å—ë –≤–∏–¥–Ω–æ
            const contentWrap = document.getElementById('contentWrap');
            if (contentWrap) contentWrap.style.display = 'block';

            const privMsg = document.querySelector('.privacy-message');
            if (privMsg) privMsg.remove();
        }
    } else {
        const contentWrap = document.getElementById('contentWrap');
        if (contentWrap) contentWrap.style.display = 'block';

        const privMsg = document.querySelector('.privacy-message');
        if (privMsg) privMsg.remove();
    }
}

function updatePrivacyButtonVisibility() {
    if (currentUser && currentUser.email === ADMIN_EMAIL) {
        privacyToggleBtn.style.display = 'inline-flex';
        loadPrivacyStatus();
    } else {
        privacyToggleBtn.style.display = 'none';
    }
}



// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ —Å—É–¥—å–∏ –∏–∑ Firebase Database
function checkIfJudge(userId, callback) {
    if (!userId) {
        callback(false);
        return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å –≤ Firebase Realtime Database
    const userRoleRef = firebase.database().ref('users/' + userId + '/role');
    userRoleRef.once('value')
        .then(snapshot => {
            const role = snapshot.val();
            const isJudge = (role === 'judges' || role === 'judge');
            callback(isJudge);
        })
        .catch(err => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏ —Å—É–¥—å–∏:', err);
            callback(false);
        });
}



// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏
document.addEventListener('click', function(e) {
    if (e.target.id === 'skinDetailModal' || e.target.closest('.modal-close')) {
        document.body.classList.remove('modal-open');
    }
});

</script>
</body>
</html>
